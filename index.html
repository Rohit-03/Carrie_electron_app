<!DOCTYPE html>
<html>
<head>
    <title>Notion-like App</title>
    
    <!-- Add React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- External CSS file -->
    <link rel="stylesheet" href="styles.css">
    
    <style>
        /* Add these styles in the head section */
        .tesla-chat-bubble {
            white-space: pre-wrap;
        }
        
        .tesla-chat-bubble strong {
            font-weight: 600;
            color: #1a1a1a;
        }
        
        .tesla-chat-bubble .contact-tag {
            display: inline-block;
            background: #e8f0fe;
            color: #1a73e8;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 500;
            margin: 0 2px;
        }
        
        /* Gmail-style email draft styling */
        .tesla-email-draft-box {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin: 12px 0;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            width: 100%;
            max-width: 750px;
            height: 400px;
            display: flex;
            flex-direction: column;
        }

        .tesla-email-draft-header {
            background: #f6f8fc;
            border-bottom: 1px solid #e0e0e0;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            border-radius: 8px 8px 0 0;
        }

        .tesla-email-draft-icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tesla-email-draft-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .tesla-email-draft-title {
            color: #202124;
            font-weight: 500;
            font-size: 14px;
        }

        .tesla-email-draft-content {
            padding: 16px;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .tesla-email-draft-field {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
        }

        .tesla-email-draft-field strong {
            color: #5f6368;
            font-size: 13px;
            width: 60px;
            flex-shrink: 0;
        }

        .tesla-email-draft-field span {
            color: #202124;
            font-size: 13px;
        }

        .tesla-email-draft-body {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 12px;
            margin: 12px 0;
            font-size: 13px;
            line-height: 1.5;
            color: #202124;
            white-space: pre-wrap;
            flex: 1;
            overflow-y: auto;
            min-height: 200px;
        }

        /* Add typing animation styles */
        .tesla-email-draft-body.typing {
            position: relative;
        }

        .tesla-email-draft-body.typing::after {
            content: '|';
            position: absolute;
            animation: blink 1s step-end infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* Update email send button to match the image */
        .tesla-email-draft-send {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 32px;
            border-radius: 24px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 80px;
        }

        .tesla-email-draft-send:hover {
            background: #3367d6;
        }

        .tesla-email-draft-send:disabled {
            background: #e8eaed;
            color: #5f6368;
            cursor: not-allowed;
        }

        .tesla-email-draft-send::after {
            content: '▼';
            margin-left: 8px;
            font-size: 10px;
            border-left: 1px solid rgba(255,255,255,0.3);
            padding-left: 8px;
        }

        .tesla-email-draft-actions {
            display: flex;
            justify-content: flex-end;
            padding: 0px 16px 12px 16px;
            margin-top: -4px;  /* Add this line */
        }

        /* Email response styling */
        .tesla-email-response-box {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin: 12px 0;
        }

        .tesla-email-response-header {
            background: #f6f8fc;
            padding: 12px 16px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            border-radius: 8px 8px 0 0;
        }

        .tesla-email-response-title {
            color: #202124;
            font-weight: 500;
            font-size: 14px;
            margin-left: 8px;
        }

        .tesla-email-response-content {
            padding: 16px;
        }

        .tesla-email-response-fields {
            margin-bottom: 12px;
        }

        .tesla-email-response-fields div {
            margin-bottom: 4px;
            font-size: 13px;
        }

        .tesla-email-response-fields strong {
            color: #5f6368;
            margin-right: 4px;
        }

        .tesla-email-response-preview {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 12px;
            font-size: 13px;
            line-height: 1.5;
            color: #202124;
            white-space: pre-wrap;
        }

        /* Add thinking animation styles */
        .tesla-thinking-animation {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            margin: 8px 0;
        }

        .tesla-thinking-dot {
            width: 8px;
            height: 8px;
            background: #000;
            border-radius: 50%;
            margin: 0 2px;
            opacity: 0.6;
            animation: thinking-pulse 1.4s infinite ease-in-out;
        }

        .tesla-thinking-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .tesla-thinking-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .tesla-thinking-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes thinking-pulse {
            0%, 100% {
                transform: scale(0.8);
                opacity: 0.6;
            }
            50% {
                transform: scale(1.2);
                opacity: 1;
            }
        }

        /* Update tool tag styling for proper text alignment */
        .tool-tag {
            display: inline-flex;
            align-items: center;
            background: #f0f9ff;
            color: #000000;
            padding: 1px 6px;
            border-radius: 12px;
            font-weight: inherit;
            margin: 0 2px;
            font-size: inherit;
            font-family: inherit;
            vertical-align: middle;
            line-height: 1;
        }

        .tool-tag img {
            width: 26px;
            height: 26px;
            margin-right: 4px;
            border-radius: 2px;
            vertical-align: center;
            margin-top: 4px;
        }

        /* Add subtle breakline styling */
        .tesla-message-breakline {
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, transparent 0%, #e5e7eb 20%, #e5e7eb 80%, transparent 100%);
            margin: 16px 0;
            opacity: 0.6;
        }

        /* PowerPoint suggestion box styling to match app theme */
        .tesla-powerpoint-suggestion-box {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin: 12px 0;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .tesla-powerpoint-suggestion-header {
            background: #fff2e6;
            border-bottom: 1px solid #e0e0e0;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            border-radius: 8px 8px 0 0;
        }

        .tesla-powerpoint-suggestion-icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tesla-powerpoint-suggestion-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .tesla-powerpoint-suggestion-title {
            color: #202124;
            font-weight: 500;
            font-size: 14px;
        }

        .tesla-powerpoint-suggestion-content {
            padding: 16px;
        }

        .tesla-powerpoint-suggestion-field {
            margin-bottom: 12px;
            font-size: 13px;
        }

        .tesla-powerpoint-suggestion-field strong {
            color: #5f6368;
            margin-right: 4px;
        }

        .tesla-powerpoint-suggestion-body {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 12px;
            margin: 12px 0;
            font-size: 13px;
            line-height: 1.5;
            color: #202124;
        }

        .tesla-powerpoint-suggestion-body p {
            margin: 8px 0;
            padding-left: 8px;
        }

        .tesla-powerpoint-suggestion-actions {
            display: flex;
            justify-content: flex-end;
            padding: 0px 16px 12px 16px;
        }

        .tesla-powerpoint-suggestion-apply {
            background: #d97706;
            color: white;
            border: none;
            padding: 8px 24px;
            border-radius: 18px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .tesla-powerpoint-suggestion-apply:hover {
            background: #b45309;
        }

        /* PowerPoint loading card styling */
        .tesla-powerpoint-loading-box {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin: 12px 0;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .tesla-powerpoint-loading-header {
            background: #fff2e6;
            border-bottom: 1px solid #e0e0e0;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            border-radius: 8px 8px 0 0;
        }

        .tesla-powerpoint-loading-content {
            padding: 16px;
            display: flex;
            align-items: center;
        }

        .tesla-powerpoint-loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #d97706;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 12px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .tesla-powerpoint-loading-text {
            color: #202124;
            font-size: 14px;
        }

        /* PowerPoint opened card styling */
        .tesla-powerpoint-opened-box {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin: 12px 0;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .tesla-powerpoint-opened-header {
            background: #fff2e6;
            border-bottom: 1px solid #e0e0e0;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            border-radius: 8px 8px 0 0;
        }

        .tesla-powerpoint-opened-content {
            padding: 16px;
            display: flex;
            align-items: center;
        }

        .tesla-powerpoint-opened-checkmark {
            width: 20px;
            height: 20px;
            background: #22c55e;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .tesla-powerpoint-opened-text {
            color: #202124;
            font-size: 14px;
        }

        /* Slack draft box styling to match app theme */
        .tesla-slack-draft-box {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin: 12px 0;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .tesla-slack-draft-header {
            background: #f8f4ff;
            border-bottom: 1px solid #e0e0e0;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            border-radius: 8px 8px 0 0;
        }

        .tesla-slack-draft-icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tesla-slack-draft-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .tesla-slack-draft-title {
            color: #202124;
            font-weight: 500;
            font-size: 14px;
        }

        .tesla-slack-draft-content {
            padding: 16px;
        }

        .tesla-slack-draft-fields {
            margin-bottom: 12px;
        }

        .tesla-slack-draft-fields div {
            margin-bottom: 4px;
            font-size: 13px;
        }

        .tesla-slack-draft-fields strong {
            color: #5f6368;
            margin-right: 4px;
        }

        .tesla-slack-draft-message {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 12px;
            margin: 12px 0;
            font-size: 13px;
            line-height: 1.5;
            color: #202124;
            white-space: pre-wrap;
        }

        .tesla-slack-draft-attachments {
            margin: 12px 0;
        }

        .tesla-slack-attachments-title {
            display: flex;
            align-items: center;
            font-size: 13px;
            font-weight: 500;
            color: #5f6368;
            margin-bottom: 8px;
        }

        .tesla-slack-attachments-title i {
            margin-right: 4px;
        }

        .tesla-slack-draft-attachment-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            margin-bottom: 4px;
        }

        .tesla-slack-attachment-info {
            margin-left: 8px;
        }

        .tesla-slack-attachment-name {
            font-size: 13px;
            color: #202124;
            font-weight: 500;
        }

        .tesla-slack-attachment-meta {
            font-size: 12px;
            color: #5f6368;
        }

        .tesla-slack-draft-actions {
            display: flex;
            justify-content: flex-end;
            padding: 0px 16px 12px 16px;
        }

        .tesla-send-slack-btn {
            background: #4a154b;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 24px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 80px;
        }

        .tesla-send-slack-btn:hover {
            background: #611f69;
        }

        .tesla-send-slack-btn:disabled {
            background: #e8eaed;
            color: #5f6368;
            cursor: not-allowed;
        }

        .tesla-send-slack-btn i {
            margin-right: 8px;
        }

        /* Report generation icon styling */
        .tesla-report-icon-container {
            width: 24px;
            height: 24px;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tesla-report-icon-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Report generation file icon styling */
        .tesla-report-file-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }

        .tesla-report-file-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Add notification badge CSS */
        .tesla-notification-badge {
            position: fixed;
            top: 32px;
            right: 32px;
            min-width: 260px;
            max-width: 340px;
            background: rgba(255,255,255,0.92);
            color: #222;
            padding: 16px 26px 16px 18px;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 500;
            box-shadow: 0 6px 24px rgba(0,0,0,0.13), 0 1.5px 4px rgba(0,0,0,0.07);
            z-index: 9999;
            opacity: 0.98;
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(200,200,200,0.13);
            transition: opacity 0.3s;
        }
        .tesla-notification-icon {
            font-size: 20px;
            margin-right: 6px;
            flex-shrink: 0;
        }
        .tesla-notification-text {
            flex: 1;
            font-size: 16px;
            color: #222;
            font-weight: 500;
            letter-spacing: 0.01em;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <!-- User Profile -->
        <div class="profile">
            <div class="avatar">RS</div>
            <div class="profile-info">
                <div class="profile-name">Rohit Shetty</div>
                <div class="profile-status">Online</div>
            </div>
        </div>
        <div class="sidebar-divider"></div>
        <!-- Central Hub -->
        <div class="sidebar-section">
            <div class="nav-item active" id="home-tab">
                <span class="sidebar-icon" aria-label="Home">
                  <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M3 12L12 3l9 9"/><path d="M9 21V9h6v12"/></svg>
                </span>
                Home
            </div>
            <div class="nav-item" id="tools-tab">
                <span class="sidebar-icon" aria-label="Tools">
                  <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06A1.65 1.65 0 0 0 15 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 8.6 15a1.65 1.65 0 0 0-1.82-.33l-.06-.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.6a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 15.4 9a1.65 1.65 0 0 0 1.82.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 15z"/></svg>
                </span>
                Tools
            </div>
        </div>
        <div class="sidebar-divider"></div>
        <!-- Projects -->
        <div class="sidebar-section">
            <div class="section-label">PROJECTS</div>
            <div class="project-list">
                <div class="project-item">
                    <span class="project-icon">📁</span>
                    Tesla Earnings Project
                </div>
            </div>
        </div>
    </div>
    <div class="main-content">
        <div class="page-content" id="main-content-home">
            <div class="notion-home">
                <div class="notion-greeting">
                    <img src="cursor.png" alt="User" class="notion-greeting-icon" />
                    <div class="notion-greeting-text">Welcome to your workspace</div>
                </div>
                <div class="notion-searchbar-wrap">
                    <div class="notion-searchbar-box">
                        <input class="notion-searchbar-input" type="text" placeholder="Ask or find anything from your workspace..." />
                        <div class="notion-searchbar-bottom">
                            <div style="flex:1"></div>
                            <div class="notion-searchbar-icons">
                                <span class="notion-searchbar-icon">📎</span>
                                <span class="notion-searchbar-icon">@</span>
                                <span class="notion-searchbar-arrow">↑</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="notion-todo-section">
                    <div class="notion-todo-title">To do</div>
                    <div class="notion-todo-list">
                        <div class="notion-todo-card">
                            <div class="notion-todo-card-new">new</div>
                            <div class="notion-todo-card-title">Slide Updates - Manager James</div>
                            <div class="notion-todo-card-desc">Refactor slides on Tesla project</div>
                            <button class="todo-start-btn" onclick="document.querySelector('.project-item').click()">Start</button>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="page-content" id="main-content-tools" style="display:none;">
            <div class="notion-section">
                <div class="notion-section-title">Tools <span style="background: #f3f3f3; color: #888; font-size: 13px; font-weight: 600; border-radius: 8px; padding: 2px 8px; margin-left: 4px;">BETA</span></div>
                <div class="notion-section-desc">Connect your favorite tools so this app can access their information, based on what you're authorized to view.</div>
                <div class="notion-tool-grid">
                    <div class="tool-card" data-tool="PowerPoint">
                        <div class="tool-icon" style="background:#f3f3f3;"><img src="https://img.icons8.com/color/48/000000/microsoft-powerpoint-2019--v1.png" width="36" height="36"/></div>
                        <div class="tool-name">PowerPoint</div>
                        <button class="connect-btn">Connect</button>
                    </div>
                    <div class="tool-card" data-tool="Slack">
                        <div class="tool-icon" style="background:#f3f3f3;"><img src="https://img.icons8.com/color/48/000000/slack-new.png" width="36" height="36"/></div>
                        <div class="tool-name">Slack</div>
                        <button class="connect-btn">Connect</button>
                    </div>
                    <div class="tool-card" data-tool="Gmail">
                        <div class="tool-icon" style="background:#f3f3f3;"><img src="https://img.icons8.com/color/48/000000/gmail-new.png" width="36" height="36"/></div>
                        <div class="tool-name">Gmail</div>
                        <button class="connect-btn">Connect</button>
                    </div>
                    <div class="tool-card" data-tool="Zoom">
                        <div class="tool-icon" style="background:#f3f3f3;"><img src="https://img.icons8.com/color/48/000000/zoom.png" width="36" height="36"/></div>
                        <div class="tool-name">Zoom</div>
                        <button class="connect-btn">Connect</button>
                    </div>
                    <div class="tool-card" data-tool="Word">
                        <div class="tool-icon" style="background:#f3f3f3;"><img src="https://img.icons8.com/color/48/000000/microsoft-word-2019--v2.png" width="36" height="36"/></div>
                        <div class="tool-name">Word</div>
                        <button class="connect-btn">Connect</button>
                    </div>
                    <div class="tool-card add-tool">
                        <span style="font-size: 2.2rem; color: #b3b3b1; margin: 0 auto;">+</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="page-content" id="main-content-tesla" style="display:none;">
            <div id="tesla-react-container"></div>
        </div>
    </div>

    <!-- React Components -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Tesla Chat Component
        function TeslaChat() {
            const [isInitialLoading, setIsInitialLoading] = useState(true);
            const [loadingText, setLoadingText] = useState('');
            const [showProjectUpdatePopup, setShowProjectUpdatePopup] = useState(false);
            const [showMeetingNotesModal, setShowMeetingNotesModal] = useState(false);
            const [showActionPrompt, setShowActionPrompt] = useState(false);
            const [messages, setMessages] = useState([]);
            const [inputText, setInputText] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [showTasks, setShowTasks] = useState(false);
            const [completedTasks, setCompletedTasks] = useState(new Set());
            const [emailStep, setEmailStep] = useState('draft'); // draft, sending, sent, received
            
            // Email typing animation state
            const [emailTypingContent, setEmailTypingContent] = useState({});
            const [isTypingEmail, setIsTypingEmail] = useState(false);
            
            // Streaming text state
            const [streamingMessageId, setStreamingMessageId] = useState(null);
            const [streamingText, setStreamingText] = useState('');
            
            // View toggle state
            const [currentView, setCurrentView] = useState('chat'); // 'chat' or 'workspace'
            
            // Animation states
            const [typedGreeting, setTypedGreeting] = useState('');
            const [showUserIcon, setShowUserIcon] = useState(false);
            const [showMeetingCard, setShowMeetingCard] = useState(false);
            const [showTasksTitle, setShowTasksTitle] = useState(false);
            const [visibleTasks, setVisibleTasks] = useState([]);
            const [showStartButton, setShowStartButton] = useState(false);
            
            const messagesEndRef = useRef(null);
            const inputRef = useRef(null);

            // Add state for Word completion
            const [wordCompleted, setWordCompleted] = useState(false);

            // Add state for PowerPoint completion
            const [powerpointCompleted, setPowerpointCompleted] = useState(false);

            // Add state for document format step
            const [documentFormatStep, setDocumentFormatStep] = useState('');

            // Add state for document generation step
            const [documentGenerationStep, setDocumentGenerationStep] = useState('');

            // Add state for document generation completion
            const [documentGenerationCompleted, setDocumentGenerationCompleted] = useState(false);

            // Add state for task clearing animation
            const [clearingTasks, setClearingTasks] = useState(false);
            const [tasksToRemove, setTasksToRemove] = useState([]);
            const [showTasksComplete, setShowTasksComplete] = useState(false);

            // Add notification state
            const [notification, setNotification] = useState(null);

            // Streaming text utility functions
            const streamText = (text, messageId, onComplete = null, speed = 4) => {
                setStreamingMessageId(messageId);
                setStreamingText('');
                
                let currentIndex = 0;
                const streamInterval = setInterval(() => {
                    if (currentIndex < text.length) {
                        setStreamingText(prev => prev + text[currentIndex]);
                        currentIndex++;
                    } else {
                        clearInterval(streamInterval);
                        setStreamingMessageId(null);
                        setStreamingText('');
                        // Update the actual message with complete text
                        setMessages(prev => prev.map(msg => 
                            msg.id === messageId ? { ...msg, text: text, isStreaming: false } : msg
                        ));
                        // Wait a bit after streaming completes before calling onComplete
                        if (onComplete) {
                            setTimeout(() => {
                                onComplete();
                            }, 500); // Wait 500ms after streaming completes
                        }
                    }
                }, speed); // use the speed parameter
            };

            const addStreamingMessage = (messageData, onComplete = null, speed = 4) => {
                const messageWithStreaming = {
                    ...messageData,
                    text: '',
                    isStreaming: true
                };
                
                setMessages(prev => [...prev, messageWithStreaming]);
                
                // Start streaming after a delay
                setTimeout(() => {
                    streamText(messageData.text, messageData.id, onComplete, speed);
                }, 100);
            };

            const addStreamingMessageWithTool = (messageData, toolName, onComplete = null) => {
                // First add the connection indicator
                const connectionMessage = {
                    ...messageData,
                    text: '',
                    isStreaming: false,
                    isConnecting: true,
                    toolName: toolName
                };
                
                setMessages(prev => [...prev, connectionMessage]);
                
                // After showing connection, replace with streaming message
                setTimeout(() => {
                    setMessages(prev => prev.filter(msg => !msg.isConnecting));
                    addStreamingMessage(messageData, onComplete);
                }, 2000); // Show connection for 2 seconds
            };

            // Helper function to add a message with UI components only after previous streaming completes
            const addMessageWithUI = (messageData, onComplete = null) => {
                // Wait for any current streaming to complete
                const checkAndAdd = () => {
                    if (streamingMessageId === null) {
                        // No streaming in progress, safe to add
                        setMessages(prev => [...prev, messageData]);
                        if (onComplete) {
                            setTimeout(onComplete, 1000); // Wait 1 second before next action
                        }
                    } else {
                        // Still streaming, check again in 100ms
                        setTimeout(checkAndAdd, 100);
                    }
                };
                checkAndAdd();
            };

            const fullGreeting = "Hey Rohit, looks like your <span class='tool-tag'><img src='https://img.icons8.com/color/48/000000/zoom.png' alt='Zoom' />Zoom</span> meeting with Manager James went well!";
            const greetingWords = fullGreeting.split(' ');

            // Typing animation effect - word by word with faster speed
            useEffect(() => {
                if (showProjectUpdatePopup) {
                    // Show user icon first
                    if (!showUserIcon) {
                        setTimeout(() => setShowUserIcon(true), 200);
                        return;
                    }
                    
                    // Only start typing after icon is visible
                    if (showUserIcon && typedGreeting !== fullGreeting) {
                        const currentWordCount = typedGreeting.split(' ').length;
                        if (currentWordCount <= greetingWords.length) {
                            const timer = setTimeout(() => {
                                const nextWords = greetingWords.slice(0, currentWordCount).join(' ');
                                if (nextWords !== typedGreeting) {
                                    setTypedGreeting(nextWords);
                                } else if (currentWordCount < greetingWords.length) {
                                    setTypedGreeting(greetingWords.slice(0, currentWordCount + 1).join(' '));
                                }
                            }, currentWordCount === 0 ? 400 : 40); // Reduced from 800ms to 400ms initial, and 80ms to 40ms between words
                            return () => clearTimeout(timer);
                        }
                    }
                }
            }, [showProjectUpdatePopup, typedGreeting, greetingWords, showUserIcon]);

            // Staggered animations after typing is complete
            useEffect(() => {
                if (typedGreeting === fullGreeting) {
                    // Show meeting card after greeting is complete (longer pause)
                    setTimeout(() => setShowMeetingCard(true), 500);
                    
                    // Show tasks title
                    setTimeout(() => setShowTasksTitle(true), 1700);
                    
                    // Show tasks one by one
                    setTimeout(() => {
                        tasks.forEach((task, index) => {
                            setTimeout(() => {
                                setVisibleTasks(prev => [...prev, task.id]);
                            }, index * 200);
                        });
                    }, 2200);
                    
                    // Show start button last
                    setTimeout(() => setShowStartButton(true), 2200 + (tasks.length * 200) + 300);
                }
            }, [typedGreeting, fullGreeting]);

            // Loading sequence
            useEffect(() => {
                const loadingSequence = [
                    { text: "Analyzing your latest internal call", duration: 200 },
                    { text: "Processing feedback from Manager James", duration: 200 },
                    { text: "Extracting action items and priorities", duration: 200 },
                    { text: "Identifying strategic improvements needed", duration: 200 },
                    { text: "Preparing your personalized task list", duration: 150 }
                ];

                let currentStep = 0;
                
                const runStep = () => {
                    if (currentStep < loadingSequence.length) {
                        setLoadingText(loadingSequence[currentStep].text);
                        setTimeout(() => {
                            currentStep++;
                            runStep();
                        }, loadingSequence[currentStep].duration);
                    } else {
                        // Loading complete, show project update popup
                        setTimeout(() => {
                            setIsInitialLoading(false);
                            setShowProjectUpdatePopup(true);
                        }, 500);
                    }
                };

                runStep();
            }, []);

            const handleStartProject = () => {
                setShowProjectUpdatePopup(false);
                
                // Reset animation states
                setTypedGreeting('');
                setShowUserIcon(false);
                setShowMeetingCard(false);
                setShowTasksTitle(false);
                setVisibleTasks([]);
                setShowStartButton(false);
                
                // Show thinking animation first
                const thinkingMessage = {
                    id: 'thinking',
                    isThinking: true,
                    sender: 'assistant',
                    timestamp: new Date()
                };
                
                setMessages([thinkingMessage]);
                
                // After thinking animation, show the actual message
                setTimeout(() => {
                    setMessages([]); // Clear thinking message
                    const initialMessage = {
                        id: 1,
                        text: `**Looks like your manager wants Slide 88 to hit harder on strategic positioning—especially vs. Waymo.**

**First step:** Let's get GTM insights from your network. I recommend reaching out to @Sarah based on her Miami activation experience.

**Shall I draft the email?**`,
                        sender: 'assistant',
                        timestamp: new Date()
                    };
                    addStreamingMessage(initialMessage, null, 4);
                }, 2000); // Show thinking for 2 seconds
            };

            const handleViewMeetingNotes = () => {
                setShowMeetingNotesModal(true);
            };

            const handleCloseMeetingNotes = () => {
                setShowMeetingNotesModal(false);
            };

            const handleActionResponse = (action) => {
                setShowActionPrompt(false);
                
                if (action === 'yes') {
                    handleSendEmail();
                } else {
                    const skipMessage = {
                        id: 2,
                        text: "No problem! I'll keep this task in your list for later. Is there anything else from your meeting that you'd like to work on right now?",
                        sender: 'assistant',
                        timestamp: new Date()
                    };
                    addStreamingMessage(skipMessage);
                }
            };

            const handleSendEmail = () => {
                setEmailStep('sending');
                
                
                setTimeout(() => {
                    setEmailStep('sent');
                    
                    // Mark first task as completed
                    setCompletedTasks(prev => new Set([...prev, 1]));
                    
                    const sentMessage = {
                        id: messages.length + 2,
                        text: "**Email sent successfully!** I've marked 'Email Sarah for GTM Insights' as completed. Sarah should receive it shortly and will likely respond with her strategic analysis.",
                        sender: 'assistant',
                        timestamp: new Date(),
                        hasBreakline: true
                    };
                    
                    // Use streaming message with tool and proper completion callback
                    addStreamingMessageWithTool(sentMessage, 'Gmail', () => {
                        // Show in-app notification after 10 seconds
                        setTimeout(() => {
                            setNotification('Sarah just replied to your email.');
                            setTimeout(() => setNotification(null), 4000); // Dismiss after 2 seconds
                        }, 5000);
                        // Longer pause before showing received file (increased from 2000 to 4000)
                    setTimeout(() => {
                        setEmailStep('received');
                        
                        const receivedMessage = {
                            id: messages.length + 3,
                                text: "**Great news!** Sarah just replied with her strategic recommendations:",
                            sender: 'assistant',
                            timestamp: new Date(),
                            hasEmailResponse: true,
                            emailResponseData: {
                                from: 'Sarah',
                                    subject: 'Re: Input needed on GTM strategy slide - Tesla Austin deck',
                                preview: `Hi Rohit,

Perfect timing on this question! James is absolutely right about making slide 88 more strategic. 

For the Austin positioning, I'd focus on these angles that worked really well in Miami:

Software flexibility vs hardware constraints: Waymo's tied to their sensor suite and predetermined routes. Tesla's neural net approach means we can adapt to new areas faster and handle edge cases they simply can't process.

Economic scalability: Our manufacturing scale gives us way better unit economics. While they're burning cash on expensive sensors and safety drivers, we're already profitable per vehicle.

Local ecosystem advantage: You've got Gigafactory Texas right there. That's not just manufacturing - it's local workforce, supply chain relationships, and political goodwill that Waymo can't replicate.

The Miami lesson was that stakeholders care most about economic viability and local impact. I'd lead with the scalability story, then hammer home the Austin infrastructure advantage.

Happy to hop on a call if you want to dig deeper into any of these.

Best,
Sarah`
                            }
                        };
                            
                            // Use addMessageWithUI to ensure proper timing
                            addMessageWithUI(receivedMessage, () => {
                                // Remove the context message entirely and go straight to PowerPoint suggestion
                                const powerpointMessage = {
                                id: messages.length + 4,
                                    text: "**Next Step: Update PowerPoint** Based on Sarah's email and Manager James's instructions, I recommend the following edits in PowerPoint:",
                                    sender: 'assistant',
                                    timestamp: new Date(),
                                    hasPowerpointSuggestion: true,
                                    powerpointData: {
                                        fileName: '2025_Tesla_GTM_Austin_v0.1.pptx',
                                        suggestedEdits: [
                                            '**Reframe slide 88** from timeline to strategic competitive positioning',
                                            '**Lead with economic scalability advantage** over Waymo\'s cash burn model',
                                            '**Highlight Gigafactory Texas** as local ecosystem advantage they can\'t replicate', 
                                            '**Emphasize software flexibility** vs Waymo\'s hardware constraints and geo-fencing',
                                            '**Position Tesla\'s user experience** as natural vs Waymo\'s science experiment feel'
                                        ]
                                    }
                                };
                                addMessageWithUI(powerpointMessage);
                            });
                        }, 6000); // Increased pause from 4000 to 6000ms (6 seconds)
                    });
                }, 2000);
            };

            const handleSendSlackMessage = () => {
                // Add "Connecting to Slack" tool message first
                const slackConnectMessage = {
                    id: messages.length + 1,
                    text: '',
                    sender: 'assistant',
                    timestamp: new Date(),
                    isConnecting: true,
                    toolName: 'Slack'
                };
                setMessages(prev => [...prev, slackConnectMessage]);
                
                // After showing Slack connection, remove it and proceed with sending
                setTimeout(() => {
                    setMessages(prev => prev.filter(msg => !(msg.isConnecting && msg.toolName === 'Slack')));
                    
                // Find the Slack draft message and update it to show loading state
                setMessages(prev => prev.map(msg => 
                    msg.hasSlackDraft ? {
                        ...msg,
                        slackData: {
                            ...msg.slackData,
                            status: 'sending'
                        }
                    } : msg
                ));
                
                setTimeout(() => {
                    // Update to sent state
                    setMessages(prev => prev.map(msg => 
                        msg.hasSlackDraft ? {
                            ...msg,
                            slackData: {
                                ...msg.slackData,
                                status: 'sent'
                            }
                        } : msg
                    ));
                    
                    // Add simple success message
                    const successMessage = {
                            id: messages.length + 2,
                        text: "✅ Slack message sent successfully!",
                        sender: 'assistant',
                        timestamp: new Date()
                    };
                    
                        addStreamingMessage(successMessage, () => {
                            // Mark task 5 (Finalize and Send Update to Manager James) as completed when Slack message is sent
                    setTimeout(() => {
                        setCompletedTasks(prev => new Set([...prev, 5]));
                        
                        const completionMessage = {
                                    id: messages.length + 3,
                            text: "I've marked 'Finalize and Send Update to Manager James' as completed.\n\n🎉 **Great work!** You've successfully coordinated with Sarah, updated your presentation with strategic insights, generated a comprehensive strategic report, and delivered all materials to your manager. **The Tesla GTM strategy is now ready for stakeholder review.**",
                            sender: 'assistant',
                            timestamp: new Date()
                        };
                                addStreamingMessage(completionMessage, () => {
                                    // After completion message is displayed, start clearing tasks
                                    setTimeout(() => {
                                        clearCompletedTasks();
                                    }, 2000); // Wait 2 seconds after completion message before clearing tasks
                                });
                            }, 500); // Brief delay before final completion
                        });
                }, 2000);
                }, 2000); // Show Slack connection for 2 seconds
            };

            const handleOpenPowerpoint = () => {
                // Remove the task completion from here - don't mark task as completed when clicking Apply
                // setCompletedTasks(prev => new Set([...prev, 2])); // REMOVED
                
                // Actually open the PowerPoint file first
                const filePath = '/Users/wafichoudhury/Downloads/2025_Tesla_GTM_Austin_v0.1.pptx';
                const { shell } = require('electron');

                // Use Electron's shell API to open with default application
                if (window.electronAPI && window.electronAPI.shell) {
                    shell.openItem(filePath);
                } else if (typeof require !== 'undefined') {
                    shell.openPath(filePath);
                } else {
                    try {
                        window.open(`file://${filePath}`, '_blank');
                    } catch (error) {
                        alert(`Opening ${filePath.split('/').pop()} in Microsoft PowerPoint...`);
                    }
                }
                
                const openingMessage = {
                    id: messages.length + 1,
                    text: "",
                    sender: 'assistant',
                    timestamp: new Date(),
                    hasPowerpointLoading: true,
                    hasBreakline: true
                };
                
                addStreamingMessage(openingMessage, () => {
                    // After 2 seconds, change to "Opened"
                setTimeout(() => {
                        setMessages(prev => prev.map(msg => 
                            msg.hasPowerpointLoading ? {
                                ...msg,
                                hasPowerpointOpened: true,
                                hasPowerpointLoading: false
                            } : msg
                        ));
                        setPowerpointCompleted(true);
                    }, 2000);
                });
            };

            const handleToggleChat = () => {
                setShowTasks(!showTasks);
            };

            const handleOpenWordDocument = (fileName) => {
                const filePath = '/Users/wafichoudhury/Desktop/Tesla_AV_Report.docx';
                const { shell } = require('electron');

                // Add loading message
                const openingMessage = {
                    id: messages.length + 1,
                    text: "",
                    sender: 'assistant',
                    timestamp: new Date(),
                    hasWordLoading: true,
                    hasBreakline: true
                };
                
                addStreamingMessage(openingMessage, () => {
                    // After 2 seconds, change to "Opened"
                    setTimeout(() => {
                        setMessages(prev => prev.map(msg => 
                            msg.hasWordLoading ? {
                                ...msg,
                                hasWordOpened: true,
                                hasWordLoading: false
                            } : msg
                        ));
                        setWordCompleted(true);
                    }, 2000);
                });

                // Use Electron's shell API to open with default application
                if (window.electronAPI && window.electronAPI.shell) {
                    shell.openItem(filePath);
                } else if (typeof require !== 'undefined') {
                    shell.openPath(filePath);
                } else {
                    try {
                        window.open(`file://${filePath}`, '_blank');
                    } catch (error) {
                        alert(`Opening ${filePath.split('/').pop()} in Microsoft Word...`);
                    }
                }
            };

            // Email typing animation function
            const startEmailTyping = (messageId, emailData) => {
                setIsTypingEmail(true);
                const fullBody = emailData.body;
                let currentText = '';
                let currentIndex = 0;
                
                // Initialize with empty body but show full box
                setEmailTypingContent(prev => ({
                    ...prev,
                    [messageId]: {
                        ...emailData,
                        body: '',
                        isTyping: true
                    }
                }));
                
                const typeNextChar = () => {
                    if (currentIndex < fullBody.length) {
                        currentText += fullBody[currentIndex];
                        setEmailTypingContent(prev => ({
                            ...prev,
                            [messageId]: {
                                ...emailData,
                                body: currentText,
                                isTyping: true
                            }
                        }));
                        currentIndex++;
                        setTimeout(typeNextChar, 3);
                    } else {
                        setIsTypingEmail(false);
                        setEmailTypingContent(prev => ({
                            ...prev,
                            [messageId]: {
                                ...emailData,
                                body: fullBody,
                                isTyping: false
                            }
                        }));
                    }
                };
                
                // Start typing after a brief delay
                setTimeout(typeNextChar, 100);
            };

            // Enhanced document generation with realistic progress stages
            const startDocumentGeneration = (onComplete) => {
                setDocumentGenerationStep('generating');
                
                // Single generating message with generic loading bar
                const generatingMessage = {
                    id: Date.now(),
                    text: "**Generating strategic report document...**",
                                sender: 'assistant',
                                timestamp: new Date(),
                                hasReportGeneration: true,
                                reportData: {
                        status: 'generating',
                        currentStep: 'Generating strategic report document...'
                                }
                            };
                            
                addMessageWithUI(generatingMessage, () => {
                    // Wait 5 seconds for realistic generation time (reduced from 8 seconds)
                            setTimeout(() => {
                        setDocumentGenerationStep('completed');
                                
                        // Update the existing message to completed status
                                setMessages(prev => prev.map(msg => 
                            msg.hasReportGeneration && msg.reportData.status === 'generating' ? {
                                        ...msg,
                                        reportData: {
                                            status: 'completed',
                                            fileName: 'Tesla_AV_Report.docx',
                                    title: 'Tesla_AV_Report.docx',
                                    description: 'Strategic comparison analysis incorporating Austin market positioning and competitive advantages',
                                    size: '2.8 MB'
                                        }
                                    } : msg
                                ));
                                
                        // Set document generation as completed and wait for user input
                        setDocumentGenerationCompleted(true);
                        
                        // Remove the automatic onComplete callback - now wait for user input
                        // if (onComplete) onComplete();
                    }, 5000); // Reduced from 8000 to 5000ms (5 seconds)
                });
            };

            // Function to clear completed tasks one by one
            const clearCompletedTasks = () => {
                setClearingTasks(true);
                const taskIds = [1, 2, 4, 5]; // All task IDs in order
                
                taskIds.forEach((taskId, index) => {
                    setTimeout(() => {
                        setTasksToRemove(prev => [...prev, taskId]);
                        
                        // If this is the last task, only reset clearing state but keep tasks removed
                        if (index === taskIds.length - 1) {
                            setTimeout(() => {
                                setClearingTasks(false);
                                // Don't reset tasksToRemove - keep tasks permanently removed
                                // Show completion message after all tasks are cleared
                                setShowTasksComplete(true);
                            }, 500); // Reduced wait time for fade out animation
                        }
                    }, index * 300); // Start immediately for first task (index 0 = 0ms delay)
                });
            };

            const tasks = [
                {
                    id: 1,
                    title: "Email Sarah for GTM Insights",
                    description: "Get Sarah's input on GTM levers that resonate, leveraging her Miami market activation experience",
                    priority: "high"
                },
                {
                    id: 2,
                    title: "Update Slide 88 - Strategic POV",
                    description: "Reframe slide 88 from timeline to competitive strategic positioning against Waymo's constraints",
                    priority: "high"
                },
                {
                    id: 4,
                    title: "Create Executive Summary",
                    description: "Draft 4-5 line exec summary for Mobility Ops team highlighting Tesla's edge and GTM wedge",
                    priority: "medium"
                },
                {
                    id: 5,
                    title: "Finalize and Send Update to Manager James",
                    priority: "medium"
                }
            ];

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            const formatTime = (date) => {
                return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            };

            const handleSendMessage = async () => {
                if (!inputText.trim() || isLoading) return;

                const newMessage = {
                    id: messages.length + 1,
                    text: inputText,
                    sender: 'user',
                    timestamp: new Date()
                };

                setMessages(prev => [...prev, newMessage]);
                const userInput = inputText.toLowerCase().trim();
                setInputText('');
                setIsLoading(true);

                // Check if document generation was just completed and user is responding
                if (documentGenerationCompleted) {
                    setDocumentGenerationCompleted(false);
                    setIsLoading(false);
                    
                    // Mark task 4 (Create Executive Summary) as completed when user responds after document generation
                    setCompletedTasks(prev => new Set([...prev, 4]));
                    
                    // Show manager update prompt
                    setTimeout(() => {
                        const managerUpdatePrompt = {
                            id: messages.length + 2,
                            text: "**Perfect!** Would you like me to send an update to Manager James about the completed deliverables? I can draft a message highlighting:\n\n• **Updated Tesla GTM presentation** with competitive positioning\n• **Strategic analysis report** with Sarah's insights\n• **Progress on all action items** from your meeting\n\n**Should I prepare this update for James?**",
                            sender: 'assistant',
                            timestamp: new Date(),
                            needsManagerUpdate: true
                        };
                        addStreamingMessage(managerUpdatePrompt);
                    }, 1000);
                    return;
                }

                // Check if PowerPoint was just completed and user is responding
                if (powerpointCompleted) {
                    setPowerpointCompleted(false);
                    setIsLoading(false);
                    
                    // Mark task 2 as completed when user sends message after PowerPoint opened
                    setCompletedTasks(prev => new Set([...prev, 2]));
                    
                    // Show the format selection message
                    setTimeout(() => {
                        const formatMessage = {
                            id: messages.length + 2,
                            text: "**Great!** Now that the PowerPoint is complete, the next step is to write a strategic report document for your internal alignment team. **What format would you prefer?**\n\n• **Word Document** (recommended)\n• **Txt File**\n• **PDF Report**\n\nPlease respond with your preference (or I'll default to Word format):",
                            sender: 'assistant',
                            timestamp: new Date(),
                            needsFormatSelection: true
                        };
                        addStreamingMessage(formatMessage);
                        setDocumentFormatStep('asked');
                    }, 1000);
                    return;
                }

                // Check if user is responding to format selection
                if (documentFormatStep === 'asked') {
                    setIsLoading(false);
                    setDocumentFormatStep('selected');
                    
                    // Determine format (default to Word if unclear)
                    let selectedFormat = 'Word Document';
                    if (userInput.includes('powerpoint') || userInput.includes('ppt')) {
                        selectedFormat = 'PowerPoint Presentation';
                    } else if (userInput.includes('pdf')) {
                        selectedFormat = 'PDF Report';
                    }
                    
                    // Show loading message for document generation
                    const loadingMessage = {
                        id: messages.length + 2,
                        text: "**Crafting the strategic report in your voice...**",
                        sender: 'assistant',
                        timestamp: new Date(),
                        isLoadingCraft: true
                    };
                    setMessages(prev => [...prev, loadingMessage]);
                    
                    // After delay, start enhanced document generation
                    setTimeout(() => {
                        setMessages(prev => prev.filter(msg => !msg.isLoadingCraft));
                        
                        // Start the enhanced document generation process without automatic completion
                        startDocumentGeneration(); // Remove the onComplete callback
                    }, 2000); // Show loading for 2 seconds before starting generation
                    return;
                }

                // Check if user is responding to manager update prompt
                const lastMessage = messages[messages.length - 1];
                if (lastMessage && lastMessage.needsManagerUpdate) {
                    setIsLoading(false);
                    
                    // Show loading message for manager update draft
                    const loadingMessage = {
                        id: messages.length + 2,
                        text: "**Crafting an update message for Manager James...**",
                        sender: 'assistant',
                        timestamp: new Date(),
                        isLoadingCraft: true
                    };
                    setMessages(prev => [...prev, loadingMessage]);
                    
                    // After delay, show manager update draft
                    setTimeout(() => {
                        setMessages(prev => prev.filter(msg => !msg.isLoadingCraft));
                        
                        const managerUpdateMessage = {
                            id: messages.length + 2,
                            text: "I've drafted an update message for Manager James with all the completed deliverables:",
                            sender: 'assistant',
                            timestamp: new Date(),
                            hasSlackDraft: true,
                            slackData: {
                                recipient: 'Manager James',
                                channel: '#tesla-gtm-project',
                                message: `Hi James,\n\nChecked in with Sarah and made those updates we talked about, files attached below. Let me know if you have any additional thoughts.`,
                                attachments: [
                                    {
                                        fileName: '2025_Tesla_GTM_Austin_v0.1.pptx',
                                        fileType: 'PowerPoint Presentation',
                                        fileSize: '4.1 MB'
                                    },
                                    {
                                        fileName: 'Tesla_vs_Waymo_Strategic_Analysis.docx',
                                        fileType: 'Word Document',
                                        fileSize: '2.8 MB'
                                    }
                                ],
                                status: 'draft'
                            }
                        };
                        addMessageWithUI(managerUpdateMessage);
                    }, 3000); // Show loading for 3 seconds
                    return;
                }

                // Check if user said no to the initial email question
                if (messages.length === 1 && (userInput === 'no' || userInput === 'n')) {
                    setIsLoading(false);
                    setTimeout(() => {
                        const skipMessage = {
                            id: messages.length + 2,
                            text: "No problem! I'll keep this task in your list for later. Is there anything else from your meeting that you'd like to work on right now?",
                            sender: 'assistant',
                            timestamp: new Date()
                        };
                        addStreamingMessage(skipMessage);
                    }, 1000);
                    return;
                }

                // Check if user is responding to the initial email question
                if (messages.length === 1) {
                    // User confirmed to draft email
                    setIsLoading(false);
                    
                    // Show email loading and draft immediately
                    setTimeout(() => {
                        showEmailLoadingAndDraft();
                    }, 500); // Short delay for better UX
                    return;
                }

                // Default responses for other messages
                setTimeout(() => {
                    const responses = [
                        "I understand. Let me help you with those presentation updates. What specific changes did your manager request?",
                        "That sounds important. Can you tell me more about what needs to be updated in the presentation?",
                        "I'm here to help! What aspects of the Tesla earnings presentation need revision?",
                        "Got it. Let's work on those updates together. What feedback did you receive about the presentation?"
                    ];
                    
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    
                    const aiResponse = {
                        id: messages.length + 2,
                        text: randomResponse,
                        sender: 'assistant',
                        timestamp: new Date()
                    };
                    
                    addStreamingMessage(aiResponse);
                    setIsLoading(false);
                }, 1500);
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                }
            };

            const handleInputChange = (e) => {
                setInputText(e.target.value);
                // Auto-resize textarea
                e.target.style.height = 'auto';
                e.target.style.height = Math.min(e.target.scrollHeight, 120) + 'px';
            };

            // Function to show email loading and draft
            const showEmailLoadingAndDraft = () => {
                // Add loading message
                const loadingMessage = {
                    id: messages.length + 2,
                    text: "Crafting the email in your voice...",
                    sender: 'assistant',
                    timestamp: new Date(),
                    isLoadingCraft: true
                };
                setMessages(prev => [...prev, loadingMessage]);
                
                // After delay, replace with actual email draft
                setTimeout(() => {
                    setMessages(prev => prev.filter(msg => !msg.isLoadingCraft));
                    
                    const emailDraftMessage = {
                        id: Date.now(), // Use timestamp for unique ID
                        text: "I've drafted an email to Sarah requesting strategic insights for our Tesla go-to-market plan:",
                        sender: 'assistant',
                        timestamp: new Date(),
                        hasEmailDraft: true,
                        emailData: {
                            to: 'Sarah@carrieai.com',
                            subject: 'Input needed on GTM strategy slide - Tesla Austin deck',
                            body: '' // Start with empty body for typing effect
                        },
                        originalEmailData: {
                            to: 'Sarah@carrieai.com',
                            subject: 'Input needed on GTM strategy slide - Tesla Austin deck',
                            body: `Hi Sarah,

Hope you're doing well. I'm working on our Tesla GTM deck for Austin and could really use your strategic perspective.

James and I just reviewed the presentation and he mentioned that slide 88 (our local deployment plan) is reading more like a timeline right now when we need it to be more of a strategic POV. Specifically, we want to frame it around "what Tesla can do that Waymo can't or won't" in the Austin market.

James mentioned you led a lot of the early market activation work for Miami and had strong thinking on which GTM levers actually resonated. Would you be able to share your thoughts on:

- Which competitive advantages we should emphasize most strongly against Waymo
- What positioning strategies would work best with Austin stakeholders  
- How to frame our software advantage enabling more flexible ops vs their geo-fenced constraints
- Any specific messaging angles that strengthened your Miami approach

I'm trying to make this slide much more surgical in how we position against Waymo's known gaps rather than just laying out our timeline.

Would really appreciate your take before we finalize this. Thanks!

Best,
Rohit`
                        }
                    };
                    addMessageWithUI(emailDraftMessage, () => {
                        // Start typing animation after message is added
                        setTimeout(() => {
                            startEmailTyping(emailDraftMessage.id, emailDraftMessage.originalEmailData);
                        }, 100);
                    });
                }, 3000); // Show loading for 3 seconds
            };

            // Show loading overlay
            if (isInitialLoading) {
                return (
                    <div className="tesla-chat-container">
                        <div className="tesla-chat-header">
                            <div className="tesla-chat-title">Tesla Earnings Project</div>
                            
                            {/* View Toggle */}
                            <div className="tesla-view-toggle">
                                <button 
                                    className={`tesla-toggle-btn ${currentView === 'chat' ? 'active' : ''}`}
                                    onClick={() => setCurrentView('chat')}
                                    title="Chat"
                                >
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                    </svg>
                                </button>
                                <button 
                                    className={`tesla-toggle-btn ${currentView === 'workspace' ? 'active' : ''}`}
                                    onClick={() => setCurrentView('workspace')}
                                    title="Workspace"
                                >
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14,2 14,8 20,8"/>
                                        <line x1="16" y1="13" x2="8" y2="13"/>
                                        <line x1="16" y1="17" x2="8" y2="17"/>
                                        <polyline points="10,9 9,9 8,9"/>
                                    </svg>
                                </button>
                            </div>

                            <button className="tesla-chat-toggle" onClick={handleToggleChat}>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                    <line x1="3" y1="6" x2="21" y2="6"/>
                                    <line x1="3" y1="12" x2="21" y2="12"/>
                                    <line x1="3" y1="18" x2="21" y2="18"/>
                                </svg>
                            </button>
                        </div>
                        <div className="tesla-chat-content">
                            <div className="tesla-loading-overlay">
                                <div className="tesla-loading-content">
                                    <div className="tesla-loading-icon"></div>
                                    <div className="tesla-loading-title">AI Assistant</div>
                                    <div className="tesla-loading-text">
                                        {loadingText}
                                        <span className="tesla-loading-dots"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="tesla-chat-container">
                    {currentView === 'workspace' && notification && (
                        <div className="tesla-notification-badge">
                            <span className="tesla-notification-icon">🔔</span>
                            <span className="tesla-notification-text">{notification}</span>
                        </div>
                    )}
                    <div className="tesla-chat-header">
                        <div className="tesla-chat-title">Tesla Earnings Project</div>
                        
                        {/* View Toggle */}
                        <div className="tesla-view-toggle">
                            <button 
                                className={`tesla-toggle-btn ${currentView === 'chat' ? 'active' : ''}`}
                                onClick={() => setCurrentView('chat')}
                                title="Chat"
                            >
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                </svg>
                            </button>
                            <button 
                                className={`tesla-toggle-btn ${currentView === 'workspace' ? 'active' : ''}`}
                                onClick={() => setCurrentView('workspace')}
                                title="Workspace"
                            >
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14,2 14,8 20,8"/>
                                    <line x1="16" y1="13" x2="8" y2="13"/>
                                    <line x1="16" y1="17" x2="8" y2="17"/>
                                    <polyline points="10,9 9,9 8,9"/>
                                </svg>
                            </button>
                        </div>

                        <button className="tesla-chat-toggle" onClick={handleToggleChat}>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                <line x1="3" y1="6" x2="21" y2="6"/>
                                <line x1="3" y1="12" x2="21" y2="12"/>
                                <line x1="3" y1="18" x2="21" y2="18"/>
                            </svg>
                        </button>
                    </div>
                    <div className="tesla-chat-content">
                        <div className={`tesla-chat-main ${showTasks ? 'with-tasks' : ''}`}>
                            {currentView === 'chat' ? (
                                /* Chat Interface */
                                <>
                                    {showProjectUpdatePopup && (
                                        <div className="tesla-project-update-overlay">
                                            <div className="tesla-project-update-card">
                                                <div className="tesla-project-update-header">
                                                    <div className="tesla-project-header-content">
                                                        {showUserIcon && (
                                                            <img src="cursor.png" alt="User" className="tesla-project-user-icon tesla-animate-in" />
                                                        )}
                                                        <h2 className={`tesla-project-greeting ${typedGreeting === fullGreeting ? 'typing-complete' : ''}`}>
                                                            <span dangerouslySetInnerHTML={{ __html: typedGreeting }} />
                                                            {typedGreeting !== fullGreeting && <span className="tesla-typing-cursor">|</span>}
                                                        </h2>
                                                    </div>
                                                </div>
                                                
                                                <div className="tesla-project-update-content">
                                                    {/* Clickable Sub-Card for Meeting Notes */}
                                                    {showMeetingCard && (
                                                        <div className="tesla-meeting-notes-card tesla-animate-in" onClick={handleViewMeetingNotes}>
                                                            <div className="tesla-meeting-notes-icon">📄</div>
                                                            <div className="tesla-meeting-notes-text">
                                                                <span className="tesla-meeting-notes-title">View Meeting Notes & Full Transcript</span>
                                                                <span className="tesla-meeting-notes-arrow">→</span>
                                                            </div>
                                                        </div>
                                                    )}

                                                    {/* Waterfall To-Do Checklist */}
                                                    <div className="tesla-waterfall-checklist">
                                                        {showTasksTitle && (
                                                            <h3 className="tesla-waterfall-title tesla-animate-in">Project Tasks</h3>
                                                        )}
                                                        <div className="tesla-waterfall-flow">
                                                            {tasks.map((task, index) => (
                                                                <div 
                                                                    key={task.id} 
                                                                    className={`tesla-waterfall-item ${visibleTasks.includes(task.id) ? 'tesla-animate-in' : ''}`}
                                                                    style={{
                                                                        opacity: visibleTasks.includes(task.id) ? 1 : 0,
                                                                        transform: visibleTasks.includes(task.id) ? 'translateY(0)' : 'translateY(30px)',
                                                                        transition: 'all 0.6s ease-out'
                                                                    }}
                                                                >
                                                                    <div className="tesla-waterfall-node">
                                                                        <div className={`tesla-waterfall-circle ${completedTasks.has(task.id) ? 'completed' : ''}`}>
                                                                            {completedTasks.has(task.id) ? '✓' : index + 1}
                                                                        </div>
                                                                        {index < tasks.length - 1 && (
                                                                            <div className="tesla-waterfall-line"></div>
                                                                        )}
                                                                    </div>
                                                                    <div className="tesla-waterfall-content">
                                                                        <div className="tesla-waterfall-task-title">{task.title}</div>
                                                                        <div className="tesla-waterfall-task-desc">{task.description}</div>
                                                                        <div className={`tesla-waterfall-priority ${task.priority}`}>
                                                                            {task.priority.toUpperCase()}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>

                                                    {/* Start Button */}
                                                    {showStartButton && (
                                                        <div className="tesla-project-update-actions">
                                                            <button className="tesla-project-start-btn tesla-animate-in" onClick={handleStartProject}>
                                                                <span className="tesla-start-btn-text">Start</span>
                                                                <span className="tesla-start-btn-arrow">→</span>
                                                            </button>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                    
                                    {showMeetingNotesModal && (
                                        <div className="tesla-modal-overlay" onClick={handleCloseMeetingNotes}>
                                            <div className="tesla-modal-content" onClick={(e) => e.stopPropagation()}>
                                                <div className="tesla-modal-header">
                                                    <h3 className="tesla-modal-title">Meeting Notes & Full Transcript</h3>
                                                    <button className="tesla-modal-close" onClick={handleCloseMeetingNotes}>
                                                        ✗
                                                    </button>
                                                </div>
                                                <div className="tesla-modal-body">
                                                    <div className="tesla-meeting-summary">
                                                        <h4>Meeting Summary</h4>
                                                        <p><strong>Date:</strong> Today, 9:37 AM CST</p>
                                                        <p><strong>Attendees:</strong> James (Manager), Rohit (Associate)</p>
                                                        <p><strong>Duration:</strong> ~11 minutes</p>
                                                    </div>
                                                    <div className="tesla-meeting-transcript">
                                                        <h4>Full Transcript</h4>
                                                        <div className="tesla-transcript-content">
                                                            <div className="transcript-conversation">
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">James</div>
                                                                    <div className="transcript-text">Hey Rohit, how's it going?</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">Rohit</div>
                                                                    <div className="transcript-text">Hey! Pretty good, just got my third coffee of the morning, so I'm officially awake now. You?</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">James</div>
                                                                    <div className="transcript-text">Haha, love that. Yeah, I'm on number two, trying to pace myself. Long day of calls ahead. But hey—I wanted to quickly chat through the Tesla GTM deck you sent over.</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">Rohit</div>
                                                                    <div className="transcript-text">Totally, I've got it open.</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">James</div>
                                                                    <div className="transcript-text">Cool. So first off, appreciate the fast turnaround. The structure's solid, and there's a lot in there we can work with. That said, I think we're still a bit too high-level in how we're telling the story—especially in light of what Waymo's already doing in Austin.</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">Rohit</div>
                                                                    <div className="transcript-text">Yeah, I was wondering about that—I wasn't sure how aggressive to be on the comparison front.</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">James</div>
                                                                    <div className="transcript-text">Right, and I don't think we need to be super aggressive, but we do need to be surgical. Like on slide 88, where you walk through the local deployment plan—right now that reads more like a timeline. What we actually need is more of a strategic POV: "What's Tesla doing here that Waymo can't or won't?"</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">Rohit</div>
                                                                    <div className="transcript-text">Okay—so reframe that slide to make it more competitive?</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">James</div>
                                                                    <div className="transcript-text">Exactly. Maybe even frame it like a response to Waymo's known gaps. For example, if Waymo's constrained to geo-fenced routes or dependent on L4 redundancies, how is Tesla's software advantage enabling more flexible ops or faster scale?</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">Rohit</div>
                                                                    <div className="transcript-text">Got it. I'll dig into some of the deployment constraints Waymo has and shape around that.</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">James</div>
                                                                    <div className="transcript-text">Perfect. Also—can you spin up a short exec summary of the GTM plan? Just 4-5 lines I can send to the Mobility Ops team. High-level stuff—what's Tesla's edge, what's the GTM wedge, and why it matters specifically in Austin.</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">Rohit</div>
                                                                    <div className="transcript-text">Yeah, no problem. I'll drop it in Slack this afternoon?</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">James</div>
                                                                    <div className="transcript-text">That works. Just tag me so I don't miss it.</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">Rohit</div>
                                                                    <div className="transcript-text">Will do.</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">James</div>
                                                                    <div className="transcript-text">Also—have you looped in Sarah yet?</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">Rohit</div>
                                                                    <div className="transcript-text">Not yet, was planning to after tightening the slides.</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">James</div>
                                                                    <div className="transcript-text">Definitely worth doing sooner. She led a lot of the early market activation work for Miami and had strong thinking on which GTM levers actually resonated. I'd get her take before we finalize.</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">Rohit</div>
                                                                    <div className="transcript-text">Yep—I'll reach out to her after this call.</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">James</div>
                                                                    <div className="transcript-text">Awesome. Thanks Rohit—once we tune a few of these pieces, I think the deck's gonna be in great shape.</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">Rohit</div>
                                                                    <div className="transcript-text">Appreciate the feedback. I'll circle back later today with the summary and a cleaned-up slide 88.</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">James</div>
                                                                    <div className="transcript-text">Sounds good. Talk soon.</div>
                                                                </div>
                                                                
                                                                <div className="transcript-message">
                                                                    <div className="transcript-speaker">Rohit</div>
                                                                    <div className="transcript-text">Later!</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="tesla-meeting-actions">
                                                        <h4>Action Items Identified</h4>
                                                        <ul>
                                                            <li>✅ Extract action items from meeting (completed)</li>
                                                            <li>📧 Email Sarah for GTM strategy insights</li>
                                                            <li>📊 Update slide 88 with competitive strategic positioning</li>
                                                            <li>📋 Create executive summary for Mobility Ops team</li>
                                                            <li>🔍 Research Waymo's deployment constraints and gaps</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                    
                                    <div className="tesla-chat-messages">
                                        {messages.map((message) => (
                                            <div key={message.id} className={`tesla-chat-message ${message.sender}`}>
                                                {message.isThinking ? (
                                                    <div className="tesla-thinking-animation">
                                                        <div className="tesla-thinking-dot"></div>
                                                        <div className="tesla-thinking-dot"></div>
                                                        <div className="tesla-thinking-dot"></div>
                                                    </div>
                                                ) : (
                                                    <>
                                                <div className={`tesla-chat-bubble ${message.sender}`}>
                                                            {message.isStreaming && streamingMessageId === message.id ? 
                                                                <>
                                                                    <span dangerouslySetInnerHTML={{ __html: renderMessageText(streamingText) }} />
                                                                    <span className="tesla-streaming-cursor">|</span>
                                                                </> 
                                                                : <div dangerouslySetInnerHTML={{ __html: renderMessageText(message.text) }} />
                                                            }
                                                </div>
                                                
                                                {/* Add breakline after specific messages */}
                                                {message.hasBreakline && (
                                                    <div className="tesla-message-breakline"></div>
                                                )}
                                                
                                                {/* Email Draft Component */}
                                                {message.hasEmailDraft && (
                                                    <div className="tesla-email-draft-box">
                                                        <div className="tesla-email-draft-header">
                                                            <div className="tesla-email-draft-icon">
                                                                <img src="gmail_icon.png" alt="Gmail" width="24" height="24" />
                                                            </div>
                                                            <span className="tesla-email-draft-title">Gmail</span>
                                                        </div>
                                                        <div className="tesla-email-draft-content">
                                                            <div className="tesla-email-draft-field">
                                                                <strong>To:</strong>
                                                                <span>{message.emailData.to}</span>
                                                            </div>
                                                            <div className="tesla-email-draft-field">
                                                                <strong>Subject:</strong>
                                                                <span>{message.emailData.subject}</span>
                                                            </div>
                                                            <div className={`tesla-email-draft-body ${emailTypingContent[message.id]?.isTyping ? 'typing' : ''}`}>
                                                                {(emailTypingContent[message.id]?.body || message.emailData.body).split('\n').map((line, index) => (
                                                                    <p key={index}>{line}</p>
                                                                ))}
                                                            </div>
                                                            <div className="tesla-email-draft-actions">
                                                                <button 
                                                                    className="tesla-email-draft-send"
                                                                    onClick={handleSendEmail}
                                                                    disabled={emailStep !== 'draft'}
                                                                >
                                                                    {emailStep === 'draft' ? 'Send' : 
                                                                     emailStep === 'sending' ? 'Sending...' : 
                                                                     'Sent ✓'}
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}
                                                
                                                {/* Received File Component */}
                                                {message.hasReceivedFile && (
                                                    <div className="tesla-file-received-box">
                                                        <div className="tesla-file-received-header">
                                                            <span className="tesla-file-received-icon">📎</span>
                                                            <span className="tesla-file-received-title">File Received</span>
                                                        </div>
                                                        <div className="tesla-file-received-content">
                                                            <div className="tesla-file-received-info">
                                                                <div className="tesla-file-received-name">{message.fileData.name}</div>
                                                                <div className="tesla-file-received-details">
                                                                    From: {message.fileData.sender} • {message.fileData.size}
                                                                </div>
                                                            </div>
                                                            <div className="tesla-file-received-status">
                                                                {message.fileStatus || 'Processing...'}
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}
                                                
                                                {/* PowerPoint Suggestion Component */}
                                                {message.hasPowerpointSuggestion && (
                                                    <div className="tesla-powerpoint-suggestion-box">
                                                        <div className="tesla-powerpoint-suggestion-header">
                                                            <div className="tesla-powerpoint-suggestion-icon">
                                                                <img src="https://img.icons8.com/color/48/000000/microsoft-powerpoint-2019--v1.png" alt="PowerPoint" width="24" height="24" />
                                                            </div>
                                                            <span className="tesla-powerpoint-suggestion-title">PowerPoint Suggestions</span>
                                                        </div>
                                                        <div className="tesla-powerpoint-suggestion-content">
                                                            <div className="tesla-powerpoint-suggestion-field">
                                                                <strong>Recommended Edits:</strong>
                                                            </div>
                                                            <div className="tesla-powerpoint-suggestion-body">
                                                                {message.powerpointData.suggestedEdits.map((edit, index) => (
                                                                    <p key={index} dangerouslySetInnerHTML={{ __html: renderMessageText(edit) }} />
                                                                ))}
                                                            </div>
                                                            <div className="tesla-powerpoint-suggestion-actions">
                                                                <button 
                                                                    className="tesla-powerpoint-suggestion-apply"
                                                                    onClick={handleOpenPowerpoint}
                                                                >
                                                                    Apply Suggestions
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}
                                                
                                                {/* Add PowerPoint loading component after the PowerPoint suggestion component */}
                                                {message.hasPowerpointLoading && (
                                                    <div className="tesla-powerpoint-loading-box">
                                                        <div className="tesla-powerpoint-loading-header">
                                                            <div className="tesla-powerpoint-suggestion-icon">
                                                                <img src="https://img.icons8.com/color/48/000000/microsoft-powerpoint-2019--v1.png" alt="PowerPoint" width="24" height="24" />
                                                            </div>
                                                            <span className="tesla-powerpoint-suggestion-title">PowerPoint</span>
                                                        </div>
                                                        <div className="tesla-powerpoint-loading-content">
                                                            <div className="tesla-powerpoint-loading-spinner"></div>
                                                            <div className="tesla-powerpoint-loading-text">Opening PowerPoint...</div>
                                                        </div>
                                                    </div>
                                                )}
                                                
                                                {/* Add PowerPoint opened component after the loading component */}
                                                {message.hasPowerpointOpened && (
                                                    <div className="tesla-powerpoint-opened-box">
                                                        <div className="tesla-powerpoint-opened-header">
                                                            <div className="tesla-powerpoint-suggestion-icon">
                                                                <img src="https://img.icons8.com/color/48/000000/microsoft-powerpoint-2019--v1.png" alt="PowerPoint" width="24" height="24" />
                                                            </div>
                                                            <span className="tesla-powerpoint-suggestion-title">PowerPoint</span>
                                                        </div>
                                                        <div className="tesla-powerpoint-opened-content">
                                                            <div className="tesla-powerpoint-opened-checkmark">✓</div>
                                                            <div className="tesla-powerpoint-opened-text">Opened</div>
                                                        </div>
                                                    </div>
                                                )}
                                                
                                                {/* Report Generation Component */}
                                                {message.hasReportGeneration && (
                                                    <div className="tesla-report-generation-box">
                                                        <div className="tesla-report-generation-header">
                                                                    <div style={{display: 'flex', alignItems: 'center'}}>
                                                                        <div className="tesla-report-icon-container">
                                                                            <img src="./word_icon.png" width="24" height="24" alt="Word" />
                                                                        </div>
                                                                        <div className="tesla-report-header-content">
                                                                            <div className="tesla-report-generation-title">Document Generation</div>
                                                            {message.reportData.status === 'generating' && (
                                                                                <div className="tesla-report-status">
                                                                                    Generating document...
                                                                                </div>
                                                            )}
                                                            {message.reportData.status === 'completed' && (
                                                                                <div className="tesla-report-status">
                                                                                    Ready to open
                                                                                </div>
                                                            )}
                                                        </div>
                                                                    </div>
                                                                    {message.reportData.status === 'generating' && (
                                                                        <div className="tesla-report-loading-wheel"></div>
                                                                    )}
                                                            </div>
                                                            {message.reportData.status === 'completed' && (
                                                                    <div className="tesla-report-generation-content">
                                                                        <div className="tesla-report-file-card">
                                                                            <div className="tesla-report-file-icon">
                                                                                <img src="./word_icon.png" width="20" height="20" alt="Word" />
                                                                            </div>
                                                                    <div className="tesla-report-file-details">
                                                                            <div className="tesla-report-file-name">{message.reportData.fileName}</div>
                                                                                <div className="tesla-report-file-meta">
                                                                                    <span>{message.reportData.size}</span>
                                                                                    <span>Word Document</span>
                                                                        </div>
                                                                    </div>
                                                                            <button className="tesla-report-open-btn" onClick={() => handleOpenWordDocument(message.reportData.fileName)}>
                                                                        <i className="fas fa-external-link-alt"></i>
                                                                                Open
                                                                    </button>
                                                                </div>
                                                                        <div className="tesla-report-description">
                                                                            {message.reportData.description}
                                                        </div>
                                                                    </div>
                                                                )}
                                                    </div>
                                                )}
                                                
                                                {/* Word Document Loading Component */}
                                                {message.hasWordLoading && (
                                                    <div className="tesla-word-loading-box">
                                                        <div className="tesla-word-loading-header">
                                                            <div className="tesla-word-icon">
                                                                <img src="./word_icon.png" alt="Word" width="24" height="24" />
                                                            </div>
                                                            <span className="tesla-word-title">Word</span>
                                                        </div>
                                                        <div className="tesla-word-loading-content">
                                                            <div className="tesla-word-loading-spinner"></div>
                                                            <div className="tesla-word-loading-text">Opening Word document...</div>
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Word Document Opened Component */}
                                                {message.hasWordOpened && (
                                                    <div className="tesla-word-opened-box">
                                                        <div className="tesla-word-opened-header">
                                                            <div className="tesla-word-icon">
                                                                <img src="./word_icon.png" alt="Word" width="24" height="24" />
                                                            </div>
                                                            <span className="tesla-word-title">Word</span>
                                                        </div>
                                                        <div className="tesla-word-opened-content">
                                                            <div className="tesla-word-opened-checkmark">✓</div>
                                                            <div className="tesla-word-opened-text">Opened</div>
                                                        </div>
                                                    </div>
                                                )}
                                                
                                                {/* Email Response Component */}
                                                {message.hasEmailResponse && (
                                                    <div className="tesla-email-response-box">
                                                        <div className="tesla-email-response-header">
                                                            <div className="tesla-email-draft-icon">
                                                                <img src="gmail_icon.png" alt="Gmail" width="24" height="24" />
                                                            </div>
                                                            <span className="tesla-email-response-title">Reply from Sarah</span>
                                                        </div>
                                                        <div className="tesla-email-response-content">
                                                            <div className="tesla-email-response-fields">
                                                                <div><strong>From:</strong> {message.emailResponseData.from}</div>
                                                                <div><strong>Subject:</strong> {message.emailResponseData.subject}</div>
                                                            </div>
                                                            <div className="tesla-email-response-preview">
                                                                {message.emailResponseData.preview}
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}
                                                
                                {message.hasSlackDraft && (
                                    <div className="tesla-slack-draft-box">
                                        <div className="tesla-slack-draft-header">
                                            <div className="tesla-slack-draft-icon">
                                                <img src="https://img.icons8.com/color/48/000000/slack-new.png" alt="Slack" width="24" height="24" />
                                            </div>
                                            <span className="tesla-slack-draft-title">Draft Slack Message</span>
                                        </div>
                                        <div className="tesla-slack-draft-content">
                                            <div className="tesla-slack-draft-fields">
                                                <div><strong>To:</strong> {message.slackData.recipient}</div>
                                            </div>
                                            <div className="tesla-slack-draft-message">
                                                {message.slackData.message}
                                            </div>
                                            {message.slackData.attachment && (
                                                <div className="tesla-slack-draft-attachment">
                                                    <i className="fas fa-paperclip"></i>
                                                    <span>{message.slackData.attachment.fileName} ({message.slackData.attachment.fileSize})</span>
                                                </div>
                                            )}
                                            {message.slackData.attachments && (
                                                <div className="tesla-slack-draft-attachments">
                                                    <div className="tesla-slack-attachments-title">
                                                        <i className="fas fa-paperclip"></i>
                                                        Attachments ({message.slackData.attachments.length})
                                                    </div>
                                                    {message.slackData.attachments.map((attachment, index) => (
                                                        <div key={index} className="tesla-slack-draft-attachment-item">
                                                                                    {attachment.fileType.includes('PowerPoint') ? (
                                                                                        <img src="https://img.icons8.com/color/48/000000/microsoft-powerpoint-2019--v1.png" width="16" height="16" alt="PowerPoint" />
                                                                                    ) : (
                                                                                        <img src="./word_icon.png" width="16" height="16" alt="Word" />
                                                                                    )}
                                                            <div className="tesla-slack-attachment-info">
                                                                <div className="tesla-slack-attachment-name">{attachment.fileName}</div>
                                                                <div className="tesla-slack-attachment-meta">{attachment.fileType} • {attachment.fileSize}</div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                        {message.slackData.status !== 'sent' && (
                                            <div className="tesla-email-draft-actions">
                                                <button 
                                                    className={`tesla-send-slack-btn ${message.slackData.status === 'sending' ? 'loading' : ''}`}
                                                    onClick={handleSendSlackMessage}
                                                    disabled={message.slackData.status === 'sending'}
                                                >
                                                    {message.slackData.status === 'sending' ? (
                                                        <>
                                                            <i className="fas fa-spinner fa-spin"></i>
                                                            Sending...
                                                        </>
                                                    ) : (
                                                        'Send'
                                                    )}
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                )}
                                                
                                                        {/* Timestamp removed */}
                                                    </>
                                                )}
                                            </div>
                                        ))}
                                        
                                        {isLoading && (
                                            <div className="tesla-chat-loading">
                                                <div className="tesla-chat-bubble assistant">
                                                    <div className="tesla-typing-indicator">
                                                        <div className="tesla-typing-dot"></div>
                                                        <div className="tesla-typing-dot"></div>
                                                        <div className="tesla-typing-dot"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                        
                                        <div ref={messagesEndRef} />
                                    </div>

                                    <div className="tesla-chat-input-container">
                                        <div className="tesla-chat-input-box">
                                            <textarea
                                                ref={inputRef}
                                                value={inputText}
                                                onChange={handleInputChange}
                                                onKeyPress={handleKeyPress}
                                                placeholder="Message about your Tesla project..."
                                                className="tesla-chat-input"
                                                rows={1}
                                            />
                                            <button
                                                onClick={handleSendMessage}
                                                disabled={!inputText.trim() || isLoading}
                                                className={`tesla-chat-send ${inputText.trim() && !isLoading ? 'active' : ''}`}
                                            >
                                                ↑
                                            </button>
                                        </div>
                                    </div>
                                </>
                            ) : (
                                /* Workspace Interface */
                                <div className="tesla-workspace">
                                    <div className="tesla-workspace-header">
                                        <h1 className="tesla-notion-title">Tesla GTM Strategy Edit - Austin vs Waymo</h1>
                                    </div>
                                    
                                    <div className="tesla-notion-content">
                                        {/* Transcript & Notes Section */}
                                        <div className="tesla-notion-section">
                                            <h2 className="tesla-notion-heading">📝 Meeting Notes & Transcript</h2>
                                            <div className="tesla-notion-text">
                                                <p><strong>Tesla GTM Deck Review with Manager James</strong> - Today, 9:37 AM CST (~11 minutes)</p>
                                                <p>Key discussion points from the meeting:</p>
                                                <ul>
                                                    <li>Feedback on Tesla GTM deck structure and content</li>
                                                    <li>Need for more surgical competitive positioning against Waymo</li>
                                                    <li>Focus on Tesla's advantages vs Waymo's constraints (geo-fencing, L4 redundancies)</li>
                                                    <li>Create executive summary for Mobility Ops team</li>
                                                    <li>Get Sarah's input on GTM levers that resonate</li>
                                                </ul>
                                                
                                                <div className="tesla-notion-callout">
                                                    🎯 <strong>Primary Actions:</strong> Update slide 88 with competitive strategic positioning, reach out to Sarah, create exec summary for Mobility Ops
                                                </div>
                                            </div>
                                        </div>

                                        {/* Presentation Section */}
                                        <div className="tesla-notion-section">
                                            <h2 className="tesla-notion-heading">📊 Presentation</h2>
                                            <div className="tesla-notion-file-link" onClick={() => window.open('#', '_blank')}>
                                                <div className="tesla-notion-file-icon powerpoint">📊</div>
                                                <div className="tesla-notion-file-info">
                                                    <div className="tesla-notion-file-name">2025_Tesla_GTM_Austin_v0.1.pptx</div>
                                                    <div className="tesla-notion-file-meta">Updated 2 minutes ago • 4.1 MB</div>
                                                </div>
                                                <div className="tesla-notion-file-action">Open →</div>
                                            </div>
                                        </div>

                                        {/* Documents Section */}
                                        {/* 
                                        <div className="tesla-notion-section">
                                            <h2 className="tesla-notion-heading">📄 Strategic Input</h2>
                                            <div className="tesla-notion-text">
                                                <p><strong>Strategic Recommendations from Sarah</strong></p>
                                                <div className="tesla-notion-callout" style={{background: '#f0f9ff', border: '1px solid #0ea5e9', borderRadius: '8px', padding: '12px', margin: '12px 0'}}>
                                                    ✅ <strong>Suggestions on which strategies to include added to context</strong><br/>
                                                    <em>Focus areas: Tesla's superior AI integration, cost advantages, and existing Austin infrastructure partnerships</em>
                                                </div>
                                            </div>
                                        </div>
                                                */} 
                                        {/* Timeline Section */}
                                        <div className="tesla-notion-section">
                                            <h2 className="tesla-notion-heading">⏰ Timeline & Deadlines</h2>
                                            <div className="tesla-notion-table">
                                                <div className="tesla-notion-table-header">
                                                    <div className="tesla-notion-table-cell">Task</div>
                                                    <div className="tesla-notion-table-cell">Status</div>
                                                    <div className="tesla-notion-table-cell">Deadline</div>
                                                </div>
                                                <div className="tesla-notion-table-row">
                                                    <div className="tesla-notion-table-cell">Request GTM Strategy Insights</div>
                                                    <div className="tesla-notion-table-cell">
                                                        <span className="tesla-notion-status done">✅ Complete</span>
                                                    </div>
                                                    <div className="tesla-notion-table-cell">Today</div>
                                                </div>
                                                <div className="tesla-notion-table-row">
                                                    <div className="tesla-notion-table-cell">Update Competitive Analysis</div>
                                                    <div className="tesla-notion-table-cell">
                                                        <span className="tesla-notion-status done">✅ Complete</span>
                                                    </div>
                                                    <div className="tesla-notion-table-cell">Today</div>
                                                </div>
                                                <div className="tesla-notion-table-row">
                                                    <div className="tesla-notion-table-cell">Develop Market Penetration Strategy</div>
                                                    <div className="tesla-notion-table-cell">
                                                        <span className="tesla-notion-status pending">⏳ In Progress</span>
                                                    </div>
                                                    <div className="tesla-notion-table-cell">Tomorrow</div>
                                                </div>
                                                <div className="tesla-notion-table-row">
                                                    <div className="tesla-notion-table-cell">Prepare Executive Summary</div>
                                                    <div className="tesla-notion-table-cell">
                                                        <span className="tesla-notion-status pending">📝 To Do</span>
                                                    </div>
                                                    <div className="tesla-notion-table-cell">Wed</div>
                                                </div>
                                                <div className="tesla-notion-table-row">
                                                    <div className="tesla-notion-table-cell">Final Review with Manager</div>
                                                    <div className="tesla-notion-table-cell">
                                                        <span className="tesla-notion-status scheduled">📅 Scheduled</span>
                                                    </div>
                                                    <div className="tesla-notion-table-cell">End of Week</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className={`tesla-task-panel ${showTasks ? 'open' : ''}`}>
                            <div className="tesla-task-header">
                                <div className="tesla-task-title">Project Tasks</div>
                                <div className="tesla-task-subtitle">Tesla GTM Strategy - Austin vs Waymo</div>
                            </div>
                            <div className="tesla-task-list">
                                {tasks
                                    .filter(task => !tasksToRemove.includes(task.id))
                                    .map((task) => (
                                    <div key={task.id} className={`tesla-task-item ${completedTasks.has(task.id) ? 'completed' : ''} ${tasksToRemove.includes(task.id) ? 'removing' : ''}`}>
                                        <div className="tesla-task-checkbox">
                                            {completedTasks.has(task.id) ? '✓' : '○'}
                                        </div>
                                        <div className="tesla-task-content">
                                            <div className="tesla-task-item-title">{task.title}</div>
                                            <div className="tesla-task-item-desc">{task.description}</div>
                                            <div className={`tesla-task-item-priority ${task.priority}`}>
                                                {task.priority.toUpperCase()} PRIORITY
                                            </div>
                                        </div>
                                    </div>
                                ))}
                                {showTasksComplete && (
                                    <div className="tesla-tasks-complete-message">
                                        All Tasks Complete! Yay
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Global variable to track if React component is mounted
        let teslaReactMounted = false;

        // Function to mount React component
        function mountTeslaChat() {
            if (!teslaReactMounted) {
                const container = document.getElementById('tesla-react-container');
                if (container) {
                    ReactDOM.render(<TeslaChat />, container);
                    teslaReactMounted = true;
                }
            }
        }

        // Function to unmount React component
        function unmountTeslaChat() {
            if (teslaReactMounted) {
                const container = document.getElementById('tesla-react-container');
                if (container) {
                    ReactDOM.unmountComponentAtNode(container);
                    teslaReactMounted = false;
                }
            }
        }

        // Update the message rendering to handle markdown and contact tags
        const renderMessageText = (text) => {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/@(\w+)/g, '<span class="contact-tag">@$1</span>');
        };
    </script>

    <!-- Existing JavaScript (keep all existing functionality) -->
    <script>
        // Home tab click
        document.getElementById('home-tab').addEventListener('click', function() {
            document.querySelectorAll('.nav-item, .project-item').forEach(i => i.classList.remove('active'));
            this.classList.add('active');
            document.getElementById('main-content-home').style.display = '';
            document.getElementById('main-content-tools').style.display = 'none';
            document.getElementById('main-content-tesla').style.display = 'none';
            unmountTeslaChat();
        });

        // Tools tab click
        document.getElementById('tools-tab').addEventListener('click', function() {
            document.querySelectorAll('.nav-item, .project-item').forEach(i => i.classList.remove('active'));
            this.classList.add('active');
            document.getElementById('main-content-home').style.display = 'none';
            document.getElementById('main-content-tools').style.display = '';
            document.getElementById('main-content-tesla').style.display = 'none';
            unmountTeslaChat();
        });

        // Project click - Updated to use React
        document.querySelectorAll('.project-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.nav-item, .project-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                document.getElementById('main-content-home').style.display = 'none';
                document.getElementById('main-content-tools').style.display = 'none';
                document.getElementById('main-content-tesla').style.display = '';
                
                // Mount React component with a small delay
                setTimeout(() => {
                    mountTeslaChat();
                }, 100);
            });
        });

        // Keep all existing functionality for other parts
        document.querySelectorAll('.connect-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                if (!btn.classList.contains('connected')) {
                    btn.classList.add('connected');
                    btn.textContent = 'Connected';
                } else {
                    btn.classList.remove('connected');
                    btn.textContent = 'Connect';
                }
            });
        });
    </script>
</body>
</html> 