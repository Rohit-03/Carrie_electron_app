<!DOCTYPE html>
<html>
<head>
    <title>Notion-like App</title>
    
    <!-- Add React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- External CSS file -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="sidebar">
        <!-- User Profile -->
        <div class="profile">
            <div class="avatar">RS</div>
            <div class="profile-info">
                <div class="profile-name">Rohit Shetty</div>
                <div class="profile-status">Online</div>
            </div>
        </div>
        <div class="sidebar-divider"></div>
        <!-- Central Hub -->
        <div class="sidebar-section">
            <div class="nav-item active" id="home-tab">
                <span class="sidebar-icon" aria-label="Home">
                  <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M3 12L12 3l9 9"/><path d="M9 21V9h6v12"/></svg>
                </span>
                Home
            </div>
            <div class="nav-item" id="tools-tab">
                <span class="sidebar-icon" aria-label="Tools">
                  <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06A1.65 1.65 0 0 0 15 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 8.6 15a1.65 1.65 0 0 0-1.82-.33l-.06-.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.6a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 15.4 9a1.65 1.65 0 0 0 1.82.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 15z"/></svg>
                </span>
                Tools
            </div>
        </div>
        <div class="sidebar-divider"></div>
        <!-- Projects -->
        <div class="sidebar-section">
            <div class="section-label">PROJECTS</div>
            <div class="project-list">
                <div class="project-item">
                    <span class="project-icon">üìÅ</span>
                    Tesla Earnings Project
                </div>
            </div>
        </div>
    </div>
    <div class="main-content">
        <div class="page-content" id="main-content-home">
            <div class="notion-home">
                <div class="notion-greeting">
                    <img src="cursor.png" alt="User" class="notion-greeting-icon" />
                    <div class="notion-greeting-text">Welcome to your workspace</div>
                </div>
                <div class="notion-searchbar-wrap">
                    <div class="notion-searchbar-box">
                        <input class="notion-searchbar-input" type="text" placeholder="Ask or find anything from your workspace..." />
                        <div class="notion-searchbar-bottom">
                            <div style="flex:1"></div>
                            <div class="notion-searchbar-icons">
                                <span class="notion-searchbar-icon">üìé</span>
                                <span class="notion-searchbar-icon">@</span>
                                <span class="notion-searchbar-arrow">‚Üë</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="notion-todo-section">
                    <div class="notion-todo-title">To do</div>
                    <div class="notion-todo-list">
                        <div class="notion-todo-card">
                            <div class="notion-todo-card-new">new</div>
                            <div class="notion-todo-card-title">Slide Updates - Manager Jeff</div>
                            <div class="notion-todo-card-desc">Refactor slides on Tesla project</div>
                            <button class="todo-start-btn" onclick="document.querySelector('.project-item').click()">Start</button>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="page-content" id="main-content-tools" style="display:none;">
            <div class="notion-section">
                <div class="notion-section-title">Tools <span style="background: #f3f3f3; color: #888; font-size: 13px; font-weight: 600; border-radius: 8px; padding: 2px 8px; margin-left: 4px;">BETA</span></div>
                <div class="notion-section-desc">Connect your favorite tools so this app can access their information, based on what you're authorized to view.</div>
                <div class="notion-tool-grid">
                    <div class="tool-card" data-tool="PowerPoint">
                        <div class="tool-icon" style="background:#f3f3f3;"><img src="https://img.icons8.com/color/48/000000/microsoft-powerpoint-2019--v1.png" width="36" height="36"/></div>
                        <div class="tool-name">PowerPoint</div>
                        <button class="connect-btn">Connect</button>
                    </div>
                    <div class="tool-card" data-tool="Slack">
                        <div class="tool-icon" style="background:#f3f3f3;"><img src="https://img.icons8.com/color/48/000000/slack-new.png" width="36" height="36"/></div>
                        <div class="tool-name">Slack</div>
                        <button class="connect-btn">Connect</button>
                    </div>
                    <div class="tool-card" data-tool="Gmail">
                        <div class="tool-icon" style="background:#f3f3f3;"><img src="https://img.icons8.com/color/48/000000/gmail-new.png" width="36" height="36"/></div>
                        <div class="tool-name">Gmail</div>
                        <button class="connect-btn">Connect</button>
                    </div>
                    <div class="tool-card" data-tool="Zoom">
                        <div class="tool-icon" style="background:#f3f3f3;"><img src="https://img.icons8.com/color/48/000000/zoom.png" width="36" height="36"/></div>
                        <div class="tool-name">Zoom</div>
                        <button class="connect-btn">Connect</button>
                    </div>
                    <div class="tool-card add-tool">
                        <span style="font-size: 2.2rem; color: #b3b3b1; margin: 0 auto;">+</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="page-content" id="main-content-tesla" style="display:none;">
            <div id="tesla-react-container"></div>
        </div>
    </div>

    <!-- React Components -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Tesla Chat Component
        function TeslaChat() {
            const [isInitialLoading, setIsInitialLoading] = useState(true);
            const [loadingText, setLoadingText] = useState('');
            const [showProjectUpdatePopup, setShowProjectUpdatePopup] = useState(false);
            const [showMeetingNotesModal, setShowMeetingNotesModal] = useState(false);
            const [showActionPrompt, setShowActionPrompt] = useState(false);
            const [messages, setMessages] = useState([]);
            const [inputText, setInputText] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [showTasks, setShowTasks] = useState(false);
            const [completedTasks, setCompletedTasks] = useState(new Set());
            const [emailStep, setEmailStep] = useState('draft'); // draft, sending, sent, received
            const [documentFormatStep, setDocumentFormatStep] = useState('waiting'); // waiting, asked, selected
            const [documentGenerationStep, setDocumentGenerationStep] = useState('idle'); // idle, analyzing, structuring, writing, finalizing, completed
            
            // Streaming text state
            const [streamingMessageId, setStreamingMessageId] = useState(null);
            const [streamingText, setStreamingText] = useState('');
            
            // View toggle state
            const [currentView, setCurrentView] = useState('chat'); // 'chat' or 'workspace'
            
            // Animation states
            const [typedGreeting, setTypedGreeting] = useState('');
            const [showUserIcon, setShowUserIcon] = useState(false);
            const [showMeetingCard, setShowMeetingCard] = useState(false);
            const [showTasksTitle, setShowTasksTitle] = useState(false);
            const [visibleTasks, setVisibleTasks] = useState([]);
            const [showStartButton, setShowStartButton] = useState(false);
            
            const messagesEndRef = useRef(null);
            const inputRef = useRef(null);

            // Streaming text utility functions
            const streamText = (text, messageId, onComplete = null) => {
                setStreamingMessageId(messageId);
                setStreamingText('');
                
                let currentIndex = 0;
                const streamInterval = setInterval(() => {
                    if (currentIndex < text.length) {
                        setStreamingText(prev => prev + text[currentIndex]);
                        currentIndex++;
                    } else {
                        clearInterval(streamInterval);
                        setStreamingMessageId(null);
                        setStreamingText('');
                        // Update the actual message with complete text
                        setMessages(prev => prev.map(msg => 
                            msg.id === messageId ? { ...msg, text: text, isStreaming: false } : msg
                        ));
                        // Wait a bit after streaming completes before calling onComplete
                        if (onComplete) {
                            setTimeout(() => {
                                onComplete();
                            }, 500); // Wait 500ms after streaming completes
                        }
                    }
                }, 15); // Much faster - reduced from 30ms to 15ms
            };

            const addStreamingMessage = (messageData, onComplete = null) => {
                const messageWithStreaming = {
                    ...messageData,
                    text: '',
                    isStreaming: true
                };
                
                setMessages(prev => [...prev, messageWithStreaming]);
                
                // Start streaming after a delay
                setTimeout(() => {
                    streamText(messageData.text, messageData.id, onComplete);
                }, 800);
            };

            const addStreamingMessageWithTool = (messageData, toolName, onComplete = null) => {
                // First add the connection indicator
                const connectionMessage = {
                    ...messageData,
                    text: '',
                    isStreaming: false,
                    isConnecting: true,
                    toolName: toolName
                };
                
                setMessages(prev => [...prev, connectionMessage]);
                
                // After showing connection, replace with streaming message
                setTimeout(() => {
                    setMessages(prev => prev.filter(msg => !msg.isConnecting));
                    addStreamingMessage(messageData, onComplete);
                }, 2000); // Show connection for 2 seconds
            };

            // Helper function to add a message with UI components only after previous streaming completes
            const addMessageWithUI = (messageData, onComplete = null) => {
                // Wait for any current streaming to complete
                const checkAndAdd = () => {
                    if (streamingMessageId === null) {
                        // No streaming in progress, safe to add
                        setMessages(prev => [...prev, messageData]);
                        if (onComplete) {
                            setTimeout(onComplete, 1000); // Wait 1 second before next action
                        }
                    } else {
                        // Still streaming, check again in 100ms
                        setTimeout(checkAndAdd, 100);
                    }
                };
                checkAndAdd();
            };

            const fullGreeting = "Hey Rohit, looks like your meeting with Manager James went well!";
            const greetingWords = fullGreeting.split(' ');

            // Typing animation effect - word by word
            useEffect(() => {
                if (showProjectUpdatePopup) {
                    // Show user icon first
                    if (!showUserIcon) {
                        setTimeout(() => setShowUserIcon(true), 200);
                        return;
                    }
                    
                    // Only start typing after icon is visible
                    if (showUserIcon && typedGreeting !== fullGreeting) {
                        const currentWordCount = typedGreeting.split(' ').length;
                        if (currentWordCount <= greetingWords.length) {
                            const timer = setTimeout(() => {
                                const nextWords = greetingWords.slice(0, currentWordCount).join(' ');
                                if (nextWords !== typedGreeting) {
                                    setTypedGreeting(nextWords);
                                } else if (currentWordCount < greetingWords.length) {
                                    setTypedGreeting(greetingWords.slice(0, currentWordCount + 1).join(' '));
                                }
                            }, currentWordCount === 0 ? 800 : 80); // Longer delay before first word
                            return () => clearTimeout(timer);
                        }
                    }
                }
            }, [showProjectUpdatePopup, typedGreeting, greetingWords, showUserIcon]);

            // Staggered animations after typing is complete
            useEffect(() => {
                if (typedGreeting === fullGreeting) {
                    // Show meeting card after greeting is complete (longer pause)
                    setTimeout(() => setShowMeetingCard(true), 500);
                    
                    // Show tasks title
                    setTimeout(() => setShowTasksTitle(true), 1700);
                    
                    // Show tasks one by one
                    setTimeout(() => {
                        tasks.forEach((task, index) => {
                            setTimeout(() => {
                                setVisibleTasks(prev => [...prev, task.id]);
                            }, index * 200);
                        });
                    }, 2200);
                    
                    // Show start button last
                    setTimeout(() => setShowStartButton(true), 2200 + (tasks.length * 200) + 300);
                }
            }, [typedGreeting, fullGreeting]);

            // Loading sequence
            useEffect(() => {
                const loadingSequence = [
                    { text: "Analyzing your latest internal call", duration: 200 },
                    { text: "Processing feedback from Manager James", duration: 200 },
                    { text: "Extracting action items and priorities", duration: 200 },
                    { text: "Identifying strategic improvements needed", duration: 200 },
                    { text: "Preparing your personalized task list", duration: 150 }
                ];

                let currentStep = 0;
                
                const runStep = () => {
                    if (currentStep < loadingSequence.length) {
                        setLoadingText(loadingSequence[currentStep].text);
                        setTimeout(() => {
                            currentStep++;
                            runStep();
                        }, loadingSequence[currentStep].duration);
                    } else {
                        // Loading complete, show project update popup
                        setTimeout(() => {
                            setIsInitialLoading(false);
                            setShowProjectUpdatePopup(true);
                        }, 500);
                    }
                };

                runStep();
            }, []);

            const handleStartProject = () => {
                setShowProjectUpdatePopup(false);
                
                // Reset animation states
                setTypedGreeting('');
                setShowUserIcon(false);
                setShowMeetingCard(false);
                setShowTasksTitle(false);
                setVisibleTasks([]);
                setShowStartButton(false);
                
                // Go directly to chat with initial streaming message
                setTimeout(() => {
                    const initialMessage = {
                        id: 1,
                        text: "James mentioned you need to get strategic insights from Sarah Chen for slide 88 of your Tesla GTM deck - specifically how to make it more competitively positioned against Waymo rather than just a timeline.\n\nWould you like me to draft an email to Sarah requesting her expertise on strategic GTM levers and competitive positioning?",
                        sender: 'assistant',
                        timestamp: new Date()
                    };
                    addStreamingMessage(initialMessage);
                }, 300);
            };

            const handleViewMeetingNotes = () => {
                setShowMeetingNotesModal(true);
            };

            const handleCloseMeetingNotes = () => {
                setShowMeetingNotesModal(false);
            };

            const handleActionResponse = (action) => {
                setShowActionPrompt(false);
                
                if (action === 'yes') {
                    handleSendEmail();
                } else {
                    const skipMessage = {
                        id: 2,
                        text: "No problem! I'll keep this task in your list for later. Is there anything else from your meeting that you'd like to work on right now?",
                        sender: 'assistant',
                        timestamp: new Date()
                    };
                    addStreamingMessage(skipMessage);
                }
            };

            const handleSendEmail = () => {
                setEmailStep('sending');
                
                // Add message about sending
                const sendingMessage = {
                    id: messages.length + 1,
                    text: "Sending email to Sarah Chen...",
                    sender: 'assistant',
                    timestamp: new Date()
                };
                setMessages(prev => [...prev, sendingMessage]);
                
                setTimeout(() => {
                    setEmailStep('sent');
                    
                    // Mark first task as completed
                    setCompletedTasks(prev => new Set([...prev, 1]));
                    
                    const sentMessage = {
                        id: messages.length + 2,
                        text: "Email sent successfully! I've marked 'Email Sarah Chen for GTM Insights' as completed. Sarah should receive it shortly and will likely respond with her strategic analysis.",
                        sender: 'assistant',
                        timestamp: new Date()
                    };
                    
                    // Use streaming message with tool and proper completion callback
                    addStreamingMessageWithTool(sentMessage, 'Gmail', () => {
                        // Only after email sent message streaming completes, show received file
                        setTimeout(() => {
                            setEmailStep('received');
                            
                            const receivedMessage = {
                                id: messages.length + 3,
                                text: "Great news! Sarah Chen just replied with her strategic recommendations:",
                                sender: 'assistant',
                                timestamp: new Date(),
                                hasEmailResponse: true,
                                emailResponseData: {
                                    from: 'Sarah Chen',
                                    subject: 'Re: Input needed on GTM strategy slide - Tesla Austin deck',
                                    preview: `Hi Rohit,

Perfect timing on this question! James is absolutely right about making slide 88 more strategic. 

For the Austin positioning, I'd focus on these angles that worked really well in Miami:

Software flexibility vs hardware constraints: Waymo's tied to their sensor suite and predetermined routes. Tesla's neural net approach means we can adapt to new areas faster and handle edge cases they simply can't process.

Economic scalability: Our manufacturing scale gives us way better unit economics. While they're burning cash on expensive sensors and safety drivers, we're already profitable per vehicle.

Local ecosystem advantage: You've got Gigafactory Texas right there. That's not just manufacturing - it's local workforce, supply chain relationships, and political goodwill that Waymo can't replicate.

The Miami lesson was that stakeholders care most about economic viability and local impact. I'd lead with the scalability story, then hammer home the Austin infrastructure advantage.

Happy to hop on a call if you want to dig deeper into any of these.

Best,
Sarah`
                                }
                            };
                            
                            // Use addMessageWithUI to ensure proper timing
                            addMessageWithUI(receivedMessage, () => {
                                // Only after email response UI is shown, add context message
                                const contextMessage = {
                                    id: messages.length + 4,
                                    text: "Strategic recommendations added to context\n\nI've analyzed Sarah's strategic recommendations and added them to my context. Now I can help you update slide 88 with the most compelling competitive positioning strategies.",
                                    sender: 'assistant',
                                    timestamp: new Date()
                                };
                                
                                addStreamingMessage(contextMessage, () => {
                                    // Only after context message streaming completes, show PowerPoint suggestion
                                    const powerpointMessage = {
                                        id: messages.length + 5,
                                        text: "I can help you update slide 88 in your PowerPoint presentation based on Sarah's strategic recommendations:",
                                        sender: 'assistant',
                                        timestamp: new Date(),
                                        hasPowerpointSuggestion: true,
                                        powerpointData: {
                                            fileName: 'Tesla_GTM_Austin_Strategy.pptx',
                                            suggestedEdits: [
                                                'Reframe slide 88 from timeline to strategic competitive positioning',
                                                'Lead with economic scalability advantage over Waymo\'s cash burn model',
                                                'Highlight Gigafactory Texas as local ecosystem advantage they can\'t replicate', 
                                                'Emphasize software flexibility vs Waymo\'s hardware constraints and geo-fencing',
                                                'Position Tesla\'s user experience as natural vs Waymo\'s science experiment feel'
                                            ]
                                        }
                                    };
                                    addMessageWithUI(powerpointMessage);
                                });
                            });
                        }, 2000);
                    });
                }, 2000);
            };

            const handleSendSlackMessage = () => {
                // Add "Connecting to Slack" tool message first
                const slackConnectMessage = {
                    id: messages.length + 1,
                    text: '',
                    sender: 'assistant',
                    timestamp: new Date(),
                    isConnecting: true,
                    toolName: 'Slack'
                };
                setMessages(prev => [...prev, slackConnectMessage]);
                
                // After showing Slack connection, remove it and proceed with sending
                setTimeout(() => {
                    setMessages(prev => prev.filter(msg => !(msg.isConnecting && msg.toolName === 'Slack')));
                    
                    // Find the Slack draft message and update it to show loading state
                    setMessages(prev => prev.map(msg => 
                        msg.hasSlackDraft ? {
                            ...msg,
                            slackData: {
                                ...msg.slackData,
                                status: 'sending'
                            }
                        } : msg
                    ));
                    
                    setTimeout(() => {
                        // Update to sent state
                        setMessages(prev => prev.map(msg => 
                            msg.hasSlackDraft ? {
                                ...msg,
                                slackData: {
                                    ...msg.slackData,
                                    status: 'sent'
                                }
                            } : msg
                        ));
                        
                        // Add simple success message
                        const successMessage = {
                            id: messages.length + 2,
                            text: "‚úÖ Slack message sent successfully!",
                            sender: 'assistant',
                            timestamp: new Date()
                        };
                        
                        addStreamingMessage(successMessage, () => {
                            // Only after success message streams, mark task as completed and show final message
                            setTimeout(() => {
                                setCompletedTasks(prev => new Set([...prev, 4]));
                                
                                const completionMessage = {
                                    id: messages.length + 3,
                                    text: "I've marked 'Develop Market Penetration Strategy' as completed.\n\nüéâ Great work! You've successfully coordinated with Sarah Chen, updated your presentation with strategic insights, generated a comprehensive strategic report, and delivered all materials to your manager. The Tesla GTM strategy is now ready for stakeholder review.",
                                    sender: 'assistant',
                                    timestamp: new Date()
                                };
                                addStreamingMessage(completionMessage);
                            }, 500); // Brief delay before final completion
                        });
                    }, 2000);
                }, 2000); // Show Slack connection for 2 seconds
            };

            const handleOpenPowerpoint = () => {
                // Mark second task as completed
                setCompletedTasks(prev => new Set([...prev, 2]));
                
                const openingMessage = {
                    id: messages.length + 1,
                    text: "Opening Tesla_GTM_Austin_Strategy.pptx and applying the strategic updates to slide 88... I've marked 'Update Slide 88 - Strategic POV' as completed.",
                    sender: 'assistant',
                    timestamp: new Date()
                };
                
                addStreamingMessage(openingMessage, () => {
                    // Only after opening message streaming completes, show completion message
                    const completedMessage = {
                        id: messages.length + 2,
                        text: "PowerPoint presentation updated successfully! Sarah's strategic insights have been integrated into slide 88. Your local deployment plan now emphasizes competitive positioning against Waymo rather than just timeline.",
                        sender: 'assistant',
                        timestamp: new Date()
                    };
                    
                    addStreamingMessage(completedMessage, () => {
                        // Actually open the PowerPoint file after completion message streams
                        const filePath = '/Users/wafichoudhury/Downloads/BCG Presentation.pptx';
                        
                        // Use Electron's shell API to open with default application
                        if (window.electronAPI && window.electronAPI.shell) {
                            // Modern Electron way
                            window.electronAPI.shell.openPath(filePath);
                        } else if (typeof require !== 'undefined') {
                            // Direct Electron access
                            const { shell } = require('electron');
                            shell.openPath(filePath);
                        } else {
                            // Fallback for browsers
                            window.open(`file://${filePath}`, '_blank');
                        }
                        
                        // Only after PowerPoint completion message streams, show format selection
                        const formatMessage = {
                            id: messages.length + 3,
                            text: "I need to generate a strategic report document for your internal alignment team. What format would you prefer?\n\n‚Ä¢ Word Document (recommended)\n‚Ä¢ PowerPoint Presentation\n‚Ä¢ PDF Report\n\nPlease respond with your preference (or I'll default to Word format):",
                            sender: 'assistant',
                            timestamp: new Date(),
                            needsFormatSelection: true
                        };
                        addStreamingMessage(formatMessage);
                        setDocumentFormatStep('asked');
                    });
                });
            };

            const handleToggleChat = () => {
                setShowTasks(!showTasks);
            };

            const handleOpenWordDocument = (fileName) => {
                // Simulate opening the Word document
                if (window.electronAPI && window.electronAPI.shell) {
                    // For Electron apps
                    window.electronAPI.shell.openPath(`/Users/wafichoudhury/Downloads/${fileName}`);
                } else {
                    // For browsers, show a notification
                    alert(`Opening ${fileName} in Microsoft Word...`);
                }
            };

            // Enhanced document generation with realistic progress stages
            const startDocumentGeneration = (onComplete) => {
                setDocumentGenerationStep('generating');
                
                // Single generating message with generic loading bar
                const generatingMessage = {
                    id: Date.now(),
                    text: "Generating strategic report document...",
                    sender: 'assistant',
                    timestamp: new Date(),
                    hasReportGeneration: true,
                    reportData: {
                        status: 'generating',
                        currentStep: 'Generating strategic report document...'
                    }
                };
                
                addMessageWithUI(generatingMessage, () => {
                    // Wait 8 seconds for realistic generation time
                    setTimeout(() => {
                        setDocumentGenerationStep('completed');
                        
                        // Completed message
                        const completedMessage = {
                            id: Date.now(),
                            text: "Strategic report completed! I've created 'Tesla_vs_Waymo_Strategic_Analysis.docx' incorporating Sarah's insights.",
                            sender: 'assistant',
                            timestamp: new Date(),
                            hasReportGeneration: true,
                            reportData: {
                                status: 'completed',
                                fileName: 'Tesla_vs_Waymo_Strategic_Analysis.docx',
                                title: 'Tesla_vs_Waymo_Strategic_Analysis.docx',
                                description: 'Strategic comparison analysis incorporating Austin market positioning and competitive advantages',
                                size: '2.8 MB'
                            }
                        };
                        
                        addMessageWithUI(completedMessage, () => {
                            if (onComplete) onComplete();
                        });
                    }, 8000); // 8 seconds total generation time
                });
            };

            const tasks = [
                {
                    id: 1,
                    title: "Email Sarah Chen for GTM Insights",
                    description: "Get Sarah's input on GTM levers that resonate, leveraging her Miami market activation experience",
                    priority: "high"
                },
                {
                    id: 2,
                    title: "Update Slide 88 - Strategic POV",
                    description: "Reframe slide 88 from timeline to competitive strategic positioning against Waymo's constraints",
                    priority: "high"
                },
                {
                    id: 3,
                    title: "Research Waymo's Deployment Gaps",
                    description: "Dig into Waymo's constraints (geo-fencing, L4 redundancies) to shape competitive narrative",
                    priority: "high"
                },
                {
                    id: 4,
                    title: "Create Executive Summary",
                    description: "Draft 4-5 line exec summary for Mobility Ops team highlighting Tesla's edge and GTM wedge",
                    priority: "medium"
                },
                {
                    id: 5,
                    title: "Finalize Deck Updates",
                    description: "Complete all strategic updates and prepare for management review",
                    priority: "medium"
                }
            ];

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            const formatTime = (date) => {
                return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            };

            const handleSendMessage = async () => {
                if (!inputText.trim() || isLoading) return;

                const newMessage = {
                    id: messages.length + 1,
                    text: inputText,
                    sender: 'user',
                    timestamp: new Date()
                };

                setMessages(prev => [...prev, newMessage]);
                const userInput = inputText.toLowerCase().trim();
                setInputText('');
                setIsLoading(true);

                // Function to show email loading and draft - moved to top level
                const showEmailLoadingAndDraft = () => {
                    // Add loading message
                    const loadingMessage = {
                        id: messages.length + 2,
                        text: "Crafting the email in your voice...",
                        sender: 'assistant',
                        timestamp: new Date(),
                        isLoadingCraft: true
                    };
                    setMessages(prev => [...prev, loadingMessage]);
                    
                    // After delay, replace with actual email draft
                    setTimeout(() => {
                        setMessages(prev => prev.filter(msg => !msg.isLoadingCraft));
                        
                        const emailDraftMessage = {
                            id: Date.now(), // Use timestamp for unique ID
                            text: "I've drafted an email to Sarah Chen requesting strategic insights for our Tesla go-to-market plan:",
                            sender: 'assistant',
                            timestamp: new Date(),
                            hasEmailDraft: true,
                            emailData: {
                                to: 'sarah.chen@company.com',
                                subject: 'Input needed on GTM strategy slide - Tesla Austin deck',
                                body: `Hi Sarah,

Hope you're doing well. I'm working on our Tesla GTM deck for Austin and could really use your strategic perspective.

James and I just reviewed the presentation and he mentioned that slide 88 (our local deployment plan) is reading more like a timeline right now when we need it to be more of a strategic POV. Specifically, we want to frame it around "what Tesla can do that Waymo can't or won't" in the Austin market.

James mentioned you led a lot of the early market activation work for Miami and had strong thinking on which GTM levers actually resonated. Would you be able to share your thoughts on:

- Which competitive advantages we should emphasize most strongly against Waymo
- What positioning strategies would work best with Austin stakeholders  
- How to frame our software advantage enabling more flexible ops vs their geo-fenced constraints
- Any specific messaging angles that strengthened your Miami approach

I'm trying to make this slide much more surgical in how we position against Waymo's known gaps rather than just laying out our timeline.

Would really appreciate your take before we finalize this. Thanks!

Best,
Rohit`
                            }
                        };
                        addMessageWithUI(emailDraftMessage);
                    }, 3000); // Show loading for 3 seconds
                };

                // Check if user said no to the initial email question
                if (messages.length === 1 && (userInput === 'no' || userInput === 'n')) {
                    setIsLoading(false);
                    setTimeout(() => {
                        const skipMessage = {
                            id: messages.length + 2,
                            text: "No problem! I'll keep this task in your list for later. Is there anything else from your meeting that you'd like to work on right now?",
                            sender: 'assistant',
                            timestamp: new Date()
                        };
                        addStreamingMessage(skipMessage);
                    }, 1000);
                    return;
                }

                // Check if user is responding to the initial email question
                if (messages.length === 1 && (userInput === 'yes' || userInput === 'y')) {
                    // User confirmed to draft email
                    setIsLoading(false);
                    
                    // Show email loading and draft immediately
                    setTimeout(() => {
                        showEmailLoadingAndDraft();
                    }, 500); // Short delay for better UX
                    return;
                }

                // Check if user is responding to format selection
                if (documentFormatStep === 'asked') {
                    setIsLoading(false);
                    setDocumentFormatStep('selected');
                    
                    // Determine format (default to Word if unclear)
                    let selectedFormat = 'Word Document';
                    if (userInput.includes('powerpoint') || userInput.includes('ppt')) {
                        selectedFormat = 'PowerPoint Presentation';
                    } else if (userInput.includes('pdf')) {
                        selectedFormat = 'PDF Report';
                    }
                    
                    // Show loading message for document generation
                    const loadingMessage = {
                        id: messages.length + 2,
                        text: "Crafting the strategic report in your voice...",
                        sender: 'assistant',
                        timestamp: new Date(),
                        isLoadingCraft: true
                    };
                    setMessages(prev => [...prev, loadingMessage]);
                    
                    // After delay, start enhanced document generation
                    setTimeout(() => {
                        setMessages(prev => prev.filter(msg => !msg.isLoadingCraft));
                        
                        // Start the enhanced document generation process
                        startDocumentGeneration(() => {
                            // Only after document generation is complete, show manager update prompt
                            const managerUpdatePrompt = {
                                id: messages.length + 10,
                                text: "Perfect! I've completed the strategic report. Would you like me to send an update to Manager Jeff about the completed deliverables? I can draft a message highlighting:\n\n‚Ä¢ Updated Tesla GTM presentation with competitive positioning\n‚Ä¢ Strategic analysis report with Sarah's insights\n‚Ä¢ Progress on all action items from your meeting\n\nShould I prepare this update for Jeff?",
                                sender: 'assistant',
                                timestamp: new Date(),
                                needsManagerUpdate: true
                            };
                            addStreamingMessage(managerUpdatePrompt);
                        });
                    }, 2000); // Show loading for 2 seconds before starting generation
                    return;
                }

                // Check if user is responding to Slack message prompt
                const lastMessage = messages[messages.length - 1];
                if (lastMessage && lastMessage.hasSlackDraft && (userInput === 'yes' || userInput === 'y')) {
                    setIsLoading(false);
                    
                    // Show loading message for Slack draft
                    const loadingMessage = {
                        id: messages.length + 2,
                        text: "Crafting the Slack message in your voice...",
                        sender: 'assistant',
                        timestamp: new Date(),
                        isLoadingCraft: true
                    };
                    setMessages(prev => [...prev, loadingMessage]);
                    
                    // After delay, replace with Slack send confirmation
                    setTimeout(() => {
                        setMessages(prev => prev.filter(msg => !msg.isLoadingCraft));
                        
                        const slackSentMessage = {
                            id: messages.length + 2,
                            text: "Slack message sent to Manager Jeff successfully! I've included both the updated Tesla GTM presentation and the strategic analysis report as attachments. Jeff should have everything he needs for review.",
                            sender: 'assistant',
                            timestamp: new Date()
                        };
                        addStreamingMessage(slackSentMessage);
                    }, 3000); // Show loading for 3 seconds
                    return;
                }

                // Check if user is responding to manager update prompt
                if (lastMessage && lastMessage.needsManagerUpdate && (userInput === 'yes' || userInput === 'y')) {
                    setIsLoading(false);
                    
                    // Show loading message for manager update draft
                    const loadingMessage = {
                        id: messages.length + 2,
                        text: "Crafting an update message for Manager Jeff...",
                        sender: 'assistant',
                        timestamp: new Date(),
                        isLoadingCraft: true
                    };
                    setMessages(prev => [...prev, loadingMessage]);
                    
                    // After delay, show manager update draft
                    setTimeout(() => {
                        setMessages(prev => prev.filter(msg => !msg.isLoadingCraft));
                        
                        const managerUpdateMessage = {
                            id: messages.length + 2,
                            text: "I've drafted an update message for Manager Jeff with all the completed deliverables:",
                            sender: 'assistant',
                            timestamp: new Date(),
                            hasSlackDraft: true,
                            slackData: {
                                recipient: 'Manager Jeff',
                                channel: '#tesla-gtm-project',
                                message: `Hi Jeff,\n\nGreat progress update on the Tesla GTM strategy project:\n\n‚úÖ **Completed Deliverables:**\n‚Ä¢ Updated Tesla GTM presentation with competitive positioning against Waymo\n‚Ä¢ Strategic analysis report incorporating Sarah Chen's market insights\n‚Ä¢ Slide 88 reframed from timeline to strategic competitive advantages\n‚Ä¢ Executive summary highlighting Tesla's edge and GTM wedge\n\nüìä **Key Strategic Improvements:**\n‚Ä¢ Focus on economic scalability vs Waymo's cash burn model\n‚Ä¢ Emphasis on Gigafactory Texas as local ecosystem advantage\n‚Ä¢ Positioning of software flexibility vs hardware constraints\n\nüìé **Documents Ready for Review:**\n‚Ä¢ Tesla_GTM_Austin_Strategy.pptx (4.1 MB)\n‚Ä¢ Tesla_vs_Waymo_Strategic_Analysis.docx (2.8 MB)\n\nAll action items from our meeting have been addressed. Ready for your review and stakeholder presentation.\n\nBest,\nRohit`,
                                attachments: [
                                    {
                                        fileName: 'Tesla_GTM_Austin_Strategy.pptx',
                                        fileType: 'PowerPoint Presentation',
                                        fileSize: '4.1 MB'
                                    },
                                    {
                                        fileName: 'Tesla_vs_Waymo_Strategic_Analysis.docx',
                                        fileType: 'Word Document',
                                        fileSize: '2.8 MB'
                                    }
                                ],
                                status: 'draft'
                            }
                        };
                        addMessageWithUI(managerUpdateMessage);
                    }, 3000); // Show loading for 3 seconds
                    return;
                }

                // Default responses for other messages
                setTimeout(() => {
                    const responses = [
                        "I understand. Let me help you with those presentation updates. What specific changes did your manager request?",
                        "That sounds important. Can you tell me more about what needs to be updated in the presentation?",
                        "I'm here to help! What aspects of the Tesla earnings presentation need revision?",
                        "Got it. Let's work on those updates together. What feedback did you receive about the presentation?"
                    ];
                    
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    
                    const aiResponse = {
                        id: messages.length + 2,
                        text: randomResponse,
                        sender: 'assistant',
                        timestamp: new Date()
                    };
                    
                    addStreamingMessage(aiResponse);
                    setIsLoading(false);
                }, 1500);
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                }
            };

            const handleInputChange = (e) => {
                setInputText(e.target.value);
                // Auto-resize textarea
                e.target.style.height = 'auto';
                e.target.style.height = Math.min(e.target.scrollHeight, 120) + 'px';
            };

            // Show loading overlay
            if (isInitialLoading) {
                return (
                    <div className="tesla-chat-container">
                        <div className="tesla-chat-header">
                            <div className="tesla-chat-title">Tesla Earnings Project</div>
                            
                            {/* View Toggle */}
                            <div className="tesla-view-toggle">
                                <button 
                                    className={`tesla-toggle-btn ${currentView === 'chat' ? 'active' : ''}`}
                                    onClick={() => setCurrentView('chat')}
                                    title="Chat"
                                >
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                    </svg>
                                </button>
                                <button 
                                    className={`tesla-toggle-btn ${currentView === 'workspace' ? 'active' : ''}`}
                                    onClick={() => setCurrentView('workspace')}
                                    title="Workspace"
                                >
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14,2 14,8 20,8"/>
                                        <line x1="16" y1="13" x2="8" y2="13"/>
                                        <line x1="16" y1="17" x2="8" y2="17"/>
                                        <polyline points="10,9 9,9 8,9"/>
                                    </svg>
                                </button>
                            </div>

                            <button className="tesla-chat-toggle" onClick={handleToggleChat}>
                                üìã
                            </button>
                        </div>
                        <div className="tesla-chat-content">
                            <div className="tesla-loading-overlay">
                                <div className="tesla-loading-content">
                                    <div className="tesla-loading-icon"></div>
                                    <div className="tesla-loading-title">AI Assistant</div>
                                    <div className="tesla-loading-text">
                                        {loadingText}
                                        <span className="tesla-loading-dots"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="tesla-chat-container">
                    <div className="tesla-chat-header">
                        <div className="tesla-chat-title">Tesla Earnings Project</div>
                        
                        {/* View Toggle */}
                        <div className="tesla-view-toggle">
                            <button 
                                className={`tesla-toggle-btn ${currentView === 'chat' ? 'active' : ''}`}
                                onClick={() => setCurrentView('chat')}
                                title="Chat"
                            >
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                </svg>
                            </button>
                            <button 
                                className={`tesla-toggle-btn ${currentView === 'workspace' ? 'active' : ''}`}
                                onClick={() => setCurrentView('workspace')}
                                title="Workspace"
                            >
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14,2 14,8 20,8"/>
                                    <line x1="16" y1="13" x2="8" y2="13"/>
                                    <line x1="16" y1="17" x2="8" y2="17"/>
                                    <polyline points="10,9 9,9 8,9"/>
                                </svg>
                            </button>
                        </div>

                        <button className="tesla-chat-toggle" onClick={handleToggleChat}>
                            üìã
                        </button>
                    </div>
                    <div className="tesla-chat-content">
                        <div className={`tesla-chat-main ${showTasks ? 'with-tasks' : ''}`}>
                            {currentView === 'chat' ? (
                                /* Chat Interface */
                                <>
                                    {showProjectUpdatePopup && (
                                        <div className="tesla-project-update-overlay">
                                            <div className="tesla-project-update-card">
                                                <div className="tesla-project-update-header">
                                                    <div className="tesla-project-header-content">
                                                        {showUserIcon && (
                                                            <img src="cursor.png" alt="User" className="tesla-project-user-icon tesla-animate-in" />
                                                        )}
                                                        <h2 className={`tesla-project-greeting ${typedGreeting === fullGreeting ? 'typing-complete' : ''}`}>
                                                            {typedGreeting}
                                                            {typedGreeting !== fullGreeting && <span className="tesla-typing-cursor">|</span>}
                                                        </h2>
                                                    </div>
                                                </div>
                                                
                                                <div className="tesla-project-update-content">
                                                    {/* Clickable Sub-Card for Meeting Notes */}
                                                    {showMeetingCard && (
                                                        <div className="tesla-meeting-notes-card tesla-animate-in" onClick={handleViewMeetingNotes}>
                                                            <div className="tesla-meeting-notes-icon">üìÑ</div>
                                                            <div className="tesla-meeting-notes-text">
                                                                <span className="tesla-meeting-notes-title">View Meeting Notes & Full Transcript</span>
                                                                <span className="tesla-meeting-notes-arrow">‚Üí</span>
                                                            </div>
                                                        </div>
                                                    )}

                                                    {/* Waterfall To-Do Checklist */}
                                                    <div className="tesla-waterfall-checklist">
                                                        {showTasksTitle && (
                                                            <h3 className="tesla-waterfall-title tesla-animate-in">Project Tasks</h3>
                                                        )}
                                                        <div className="tesla-waterfall-flow">
                                                            {tasks.map((task, index) => (
                                                                <div 
                                                                    key={task.id} 
                                                                    className={`tesla-waterfall-item ${visibleTasks.includes(task.id) ? 'tesla-animate-in' : ''}`}
                                                                    style={{
                                                                        opacity: visibleTasks.includes(task.id) ? 1 : 0,
                                                                        transform: visibleTasks.includes(task.id) ? 'translateY(0)' : 'translateY(30px)',
                                                                        transition: 'all 0.6s ease-out'
                                                                    }}
                                                                >
                                                                    <div className="tesla-waterfall-node">
                                                                        <div className={`tesla-waterfall-circle ${completedTasks.has(task.id) ? 'completed' : ''}`}>
                                                                            {completedTasks.has(task.id) ? '‚úì' : index + 1}
                                                                        </div>
                                                                        {index < tasks.length - 1 && (
                                                                            <div className="tesla-waterfall-line"></div>
                                                                        )}
                                                                    </div>
                                                                    <div className="tesla-waterfall-content">
                                                                        <div className="tesla-waterfall-task-title">{task.title}</div>
                                                                        <div className="tesla-waterfall-task-desc">{task.description}</div>
                                                                        <div className={`tesla-waterfall-priority ${task.priority}`}>
                                                                            {task.priority.toUpperCase()}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>

                                                    {/* Start Button */}
                                                    {showStartButton && (
                                                        <div className="tesla-project-update-actions">
                                                            <button className="tesla-project-start-btn tesla-animate-in" onClick={handleStartProject}>
                                                                <span className="tesla-start-btn-text">Start</span>
                                                                <span className="tesla-start-btn-arrow">‚Üí</span>
                                                            </button>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                    
                                    {showMeetingNotesModal && (
                                        <div className="tesla-modal-overlay" onClick={handleCloseMeetingNotes}>
                                            <div className="tesla-modal-content" onClick={(e) => e.stopPropagation()}>
                                                <div className="tesla-modal-header">
                                                    <h3 className="tesla-modal-title">Meeting Notes & Full Transcript</h3>
                                                    <button className="tesla-modal-close" onClick={handleCloseMeetingNotes}>
                                                        ‚úó
                                                    </button>
                                                </div>
                                                <div className="tesla-modal-body">
                                                    <div className="tesla-meeting-summary">
                                                        <h4>Meeting Summary</h4>
                                                        <p><strong>Date:</strong> Today, 9:37 AM CST</p>
                                                        <p><strong>Attendees:</strong> James (Manager), Rohit (Associate)</p>
                                                        <p><strong>Duration:</strong> ~11 minutes</p>
                                                    </div>
                                                    <div className="tesla-meeting-transcript">
                                                        <h4>Full Transcript</h4>
                                                        <div className="tesla-transcript-content">
                                                            <p><strong>James:</strong> Hey Rohit, how's it going?</p>
                                                            <p><strong>Rohit:</strong> Hey! Pretty good, just got my third coffee of the morning, so I'm officially awake now. You?</p>
                                                            <p><strong>James:</strong> Haha, love that. Yeah, I'm on number two, trying to pace myself. Long day of calls ahead. But hey‚ÄîI wanted to quickly chat through the Tesla GTM deck you sent over.</p>
                                                            <p><strong>Rohit:</strong> Totally, I've got it open.</p>
                                                            <p><strong>James:</strong> Cool. So first off, appreciate the fast turnaround. The structure's solid, and there's a lot in there we can work with. That said, I think we're still a bit too high-level in how we're telling the story‚Äîespecially in light of what Waymo's already doing in Austin.</p>
                                                            <p><strong>Rohit:</strong> Yeah, I was wondering about that‚ÄîI wasn't sure how aggressive to be on the comparison front.</p>
                                                            <p><strong>James:</strong> Right, and I don't think we need to be super aggressive, but we do need to be surgical. Like on slide 88, where you walk through the local deployment plan‚Äîright now that reads more like a timeline. What we actually need is more of a strategic POV: "What's Tesla doing here that Waymo can't or won't?"</p>
                                                            <p><strong>Rohit:</strong> Okay‚Äîso reframe that slide to make it more competitive?</p>
                                                            <p><strong>James:</strong> Exactly. Maybe even frame it like a response to Waymo's known gaps. For example, if Waymo's constrained to geo-fenced routes or dependent on L4 redundancies, how is Tesla's software advantage enabling more flexible ops or faster scale?</p>
                                                            <p><strong>Rohit:</strong> Got it. I'll dig into some of the deployment constraints Waymo has and shape around that.</p>
                                                            <p><strong>James:</strong> Perfect. Also‚Äîcan you spin up a short exec summary of the GTM plan? Just 4-5 lines I can send to the Mobility Ops team. High-level stuff‚Äîwhat's Tesla's edge, what's the GTM wedge, and why it matters specifically in Austin.</p>
                                                            <p><strong>Rohit:</strong> Yeah, no problem. I'll drop it in Slack this afternoon?</p>
                                                            <p><strong>James:</strong> That works. Just tag me so I don't miss it.</p>
                                                            <p><strong>Rohit:</strong> Will do.</p>
                                                            <p><strong>James:</strong> Also‚Äîhave you looped in Sarah Chen yet?</p>
                                                            <p><strong>Rohit:</strong> Not yet, was planning to after tightening the slides.</p>
                                                            <p><strong>James:</strong> Definitely worth doing sooner. She led a lot of the early market activation work for Miami and had strong thinking on which GTM levers actually resonated. I'd get her take before we finalize.</p>
                                                            <p><strong>Rohit:</strong> Yep‚ÄîI'll reach out to her after this call.</p>
                                                            <p><strong>James:</strong> Awesome. Thanks Rohit‚Äîonce we tune a few of these pieces, I think the deck's gonna be in great shape.</p>
                                                            <p><strong>Rohit:</strong> Appreciate the feedback. I'll circle back later today with the summary and a cleaned-up slide 88.</p>
                                                            <p><strong>James:</strong> Sounds good. Talk soon.</p>
                                                            <p><strong>Rohit:</strong> Later!</p>
                                                        </div>
                                                    </div>
                                                    <div className="tesla-meeting-actions">
                                                        <h4>Action Items Identified</h4>
                                                        <ul>
                                                            <li>‚úÖ Extract action items from meeting (completed)</li>
                                                            <li>üìß Email Sarah Chen for GTM strategy insights</li>
                                                            <li>üìä Update slide 88 with competitive strategic positioning</li>
                                                            <li>üìã Create executive summary for Mobility Ops team</li>
                                                            <li>üîç Research Waymo's deployment constraints and gaps</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                    
                                    <div className="tesla-chat-messages">
                                        {messages.map((message) => (
                                            <div key={message.id} className={`tesla-chat-message ${message.sender}`}>
                                                {/* Tool Connection Component */}
                                                {message.isConnecting && (
                                                    <div className="tesla-tool-connection">
                                                        <div className="tesla-tool-icon slack">
                                                            <i className="fab fa-slack"></i>
                                                        </div>
                                                        <div className="tesla-tool-spinner">
                                                            <i className="fas fa-spinner fa-spin"></i>
                                                        </div>
                                                        <span>Connecting to {message.toolName}...</span>
                                                    </div>
                                                )}
                                                
                                                {/* Regular message content */}
                                                {!message.isConnecting && (
                                                    <>
                                                        <div className={`tesla-chat-bubble ${message.sender}`}>
                                                            {message.isStreaming && streamingMessageId === message.id ? 
                                                                <>
                                                                    {streamingText}
                                                                    <span className="tesla-streaming-cursor">|</span>
                                                                </> 
                                                                : message.text
                                                            }
                                                        </div>
                                                        
                                                        {/* Email Draft Component */}
                                                        {message.hasEmailDraft && (
                                                            <div className="tesla-email-draft-box">
                                                                <div className="tesla-email-draft-header">
                                                                    <span className="tesla-email-draft-icon">üìß</span>
                                                                    <span className="tesla-email-draft-title">Email Draft</span>
                                                                </div>
                                                                <div className="tesla-email-draft-content">
                                                                    <div className="tesla-email-draft-field">
                                                                        <strong>To:</strong> {message.emailData.to}
                                                                    </div>
                                                                    <div className="tesla-email-draft-field">
                                                                        <strong>Subject:</strong> {message.emailData.subject}
                                                                    </div>
                                                                    <div className="tesla-email-draft-body">
                                                                        {message.emailData.body.split('\n').map((line, index) => (
                                                                            <p key={index}>{line}</p>
                                                                        ))}
                                                                    </div>
                                                                    <div className="tesla-email-draft-actions">
                                                                        <button 
                                                                            className="tesla-email-draft-send"
                                                                            onClick={handleSendEmail}
                                                                            disabled={emailStep !== 'draft'}
                                                                        >
                                                                            {emailStep === 'draft' ? 'Send Email' : 
                                                                             emailStep === 'sending' ? 'Sending...' : 
                                                                             'Email Sent ‚úì'}
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        )}
                                                        
                                                        {/* Received File Component */}
                                                        {message.hasReceivedFile && (
                                                            <div className="tesla-file-received-box">
                                                                <div className="tesla-file-received-header">
                                                                    <span className="tesla-file-received-icon">üìé</span>
                                                                    <span className="tesla-file-received-title">File Received</span>
                                                                </div>
                                                                <div className="tesla-file-received-content">
                                                                    <div className="tesla-file-received-info">
                                                                        <div className="tesla-file-received-name">{message.fileData.name}</div>
                                                                        <div className="tesla-file-received-details">
                                                                            From: {message.fileData.sender} ‚Ä¢ {message.fileData.size}
                                                                        </div>
                                                                    </div>
                                                                    <div className="tesla-file-received-status">
                                                                        {message.fileStatus || 'Processing...'}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        )}
                                                        
                                                        {/* PowerPoint Suggestion Component */}
                                                        {message.hasPowerpointSuggestion && (
                                                            <div className="tesla-powerpoint-suggestion-box">
                                                                <div className="tesla-powerpoint-suggestion-header">
                                                                    <span className="tesla-powerpoint-suggestion-icon">üìä</span>
                                                                    <span className="tesla-powerpoint-suggestion-title">PowerPoint Suggestion</span>
                                                                </div>
                                                                <div className="tesla-powerpoint-suggestion-content">
                                                                    <div className="tesla-powerpoint-suggestion-field">
                                                                        <strong>Suggested Edits:</strong>
                                                                    </div>
                                                                    <div className="tesla-powerpoint-suggestion-body">
                                                                        {message.powerpointData.suggestedEdits.map((edit, index) => (
                                                                            <p key={index}>{edit}</p>
                                                                        ))}
                                                                    </div>
                                                                    <div className="tesla-powerpoint-suggestion-actions">
                                                                        <button 
                                                                            className="tesla-powerpoint-suggestion-apply"
                                                                            onClick={handleOpenPowerpoint}
                                                                        >
                                                                            Apply Suggestion
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        )}
                                                        
                                                        {/* Report Generation Component */}
                                                        {message.hasReportGeneration && (
                                                            <div className="tesla-report-generation-box">
                                                                <div className="tesla-report-generation-header">
                                                                    <div style={{display: 'flex', alignItems: 'center'}}>
                                                                        <div className="tesla-report-icon-container">
                                                                            <i className="fas fa-file-word"></i>
                                                                        </div>
                                                                        <div className="tesla-report-header-content">
                                                                            <div className="tesla-report-generation-title">Document Generation</div>
                                                                            {message.reportData.status === 'generating' && (
                                                                                <div className="tesla-report-status">
                                                                                    Generating document...
                                                                                </div>
                                                                            )}
                                                                            {message.reportData.status === 'completed' && (
                                                                                <div className="tesla-report-status">
                                                                                    Ready to open
                                                                                </div>
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                    {message.reportData.status === 'generating' && (
                                                                        <div className="tesla-report-loading-wheel"></div>
                                                                    )}
                                                                </div>
                                                                {message.reportData.status === 'completed' && (
                                                                    <div className="tesla-report-generation-content">
                                                                        <div className="tesla-report-file-card">
                                                                            <div className="tesla-report-file-icon">
                                                                                <i className="fas fa-file-word"></i>
                                                                            </div>
                                                                            <div className="tesla-report-file-details">
                                                                                <div className="tesla-report-file-name">{message.reportData.fileName}</div>
                                                                                <div className="tesla-report-file-meta">
                                                                                    <span>{message.reportData.size}</span>
                                                                                    <span>Word Document</span>
                                                                                </div>
                                                                            </div>
                                                                            <button className="tesla-report-open-btn" onClick={() => handleOpenWordDocument(message.reportData.fileName)}>
                                                                                <i className="fas fa-external-link-alt"></i>
                                                                                Open
                                                                            </button>
                                                                        </div>
                                                                        <div className="tesla-report-description">
                                                                            {message.reportData.description}
                                                                        </div>
                                                                    </div>
                                                                )}
                                                            </div>
                                                        )}
                                                        
                                                        {/* Email Response Component */}
                                                        {message.hasEmailResponse && (
                                                            <div className="tesla-email-response-box">
                                                                <div className="tesla-email-response-header">
                                                                    <i className="fas fa-envelope"></i>
                                                                    <span className="tesla-email-response-title">Email Reply from Sarah Chen</span>
                                                                </div>
                                                                <div className="tesla-email-response-content">
                                                                    <div className="tesla-email-response-fields">
                                                                        <div><strong>From:</strong> {message.emailResponseData.from}</div>
                                                                        <div><strong>Subject:</strong> {message.emailResponseData.subject}</div>
                                                                    </div>
                                                                    <div className="tesla-email-response-preview">
                                                                        {message.emailResponseData.preview}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        )}
                                                        
                                                        {message.hasSlackDraft && (
                                                            <div className="tesla-slack-draft-box">
                                                                <div className="tesla-slack-draft-header">
                                                                    <i className="fab fa-slack"></i>
                                                                    <span className="tesla-slack-draft-title">Draft Slack Message</span>
                                                                </div>
                                                                <div className="tesla-slack-draft-content">
                                                                    <div className="tesla-slack-draft-fields">
                                                                        <div><strong>To:</strong> {message.slackData.recipient}</div>
                                                                        <div><strong>Channel:</strong> {message.slackData.channel}</div>
                                                                    </div>
                                                                    <div className="tesla-slack-draft-message">
                                                                        {message.slackData.message}
                                                                    </div>
                                                                    {message.slackData.attachment && (
                                                                        <div className="tesla-slack-draft-attachment">
                                                                            <i className="fas fa-paperclip"></i>
                                                                            <span>{message.slackData.attachment.fileName} ({message.slackData.attachment.fileSize})</span>
                                                                        </div>
                                                                    )}
                                                                    {message.slackData.attachments && (
                                                                        <div className="tesla-slack-draft-attachments">
                                                                            <div className="tesla-slack-attachments-title">
                                                                                <i className="fas fa-paperclip"></i>
                                                                                Attachments ({message.slackData.attachments.length})
                                                                            </div>
                                                                            {message.slackData.attachments.map((attachment, index) => (
                                                                                <div key={index} className="tesla-slack-draft-attachment-item">
                                                                                    <i className={`fas ${attachment.fileType.includes('PowerPoint') ? 'fa-file-powerpoint' : 'fa-file-word'}`}></i>
                                                                                    <div className="tesla-slack-attachment-info">
                                                                                        <div className="tesla-slack-attachment-name">{attachment.fileName}</div>
                                                                                        <div className="tesla-slack-attachment-meta">{attachment.fileType} ‚Ä¢ {attachment.fileSize}</div>
                                                                                    </div>
                                                                                </div>
                                                                            ))}
                                                                        </div>
                                                                    )}
                                                                </div>
                                                                {message.slackData.status !== 'sent' && (
                                                                    <div className="tesla-slack-draft-actions">
                                                                        <button 
                                                                            className={`tesla-send-slack-btn ${message.slackData.status === 'sending' ? 'loading' : ''}`}
                                                                            onClick={handleSendSlackMessage}
                                                                            disabled={message.slackData.status === 'sending'}
                                                                        >
                                                                            {message.slackData.status === 'sending' ? (
                                                                                <>
                                                                                    <i className="fas fa-spinner fa-spin"></i>
                                                                                    Sending...
                                                                                </>
                                                                            ) : (
                                                                                <>
                                                                                    <i className="fab fa-slack"></i>
                                                                                    Send Slack Message
                                                                                </>
                                                                            )}
                                                                        </button>
                                                                    </div>
                                                                )}
                                                            </div>
                                                        )}
                                                
                                                        <div className="tesla-chat-timestamp">
                                                            {formatTime(message.timestamp)}
                                                        </div>
                                                    </>
                                                )}
                                            </div>
                                        ))}
                                        
                                        {isLoading && (
                                            <div className="tesla-chat-loading">
                                                <div className="tesla-chat-bubble assistant">
                                                    <div className="tesla-typing-indicator">
                                                        <div className="tesla-typing-dot"></div>
                                                        <div className="tesla-typing-dot"></div>
                                                        <div className="tesla-typing-dot"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                        
                                        <div ref={messagesEndRef} />
                                    </div>

                                    <div className="tesla-chat-input-container">
                                        <div className="tesla-chat-input-box">
                                            <textarea
                                                ref={inputRef}
                                                value={inputText}
                                                onChange={handleInputChange}
                                                onKeyPress={handleKeyPress}
                                                placeholder="Message about your Tesla project..."
                                                className="tesla-chat-input"
                                                rows={1}
                                            />
                                            <button
                                                onClick={handleSendMessage}
                                                disabled={!inputText.trim() || isLoading}
                                                className={`tesla-chat-send ${inputText.trim() && !isLoading ? 'active' : ''}`}
                                            >
                                                ‚Üë
                                            </button>
                                        </div>
                                    </div>
                                </>
                            ) : (
                                /* Workspace Interface */
                                <div className="tesla-workspace">
                                    <div className="tesla-workspace-header">
                                        <h1 className="tesla-notion-title">üöó Tesla GTM Strategy - Austin vs Waymo</h1>
                                    </div>
                                    
                                    <div className="tesla-notion-content">
                                        {/* Transcript & Notes Section */}
                                        <div className="tesla-notion-section">
                                            <h2 className="tesla-notion-heading">üìù Meeting Notes & Transcript</h2>
                                            <div className="tesla-notion-text">
                                                <p><strong>Tesla GTM Deck Review with Manager James</strong> - Today, 9:37 AM CST (~11 minutes)</p>
                                                <p>Key discussion points from the meeting:</p>
                                                <ul>
                                                    <li>Feedback on Tesla GTM deck structure and content</li>
                                                    <li>Need for more surgical competitive positioning against Waymo</li>
                                                    <li>Slide 88 needs strategic POV rather than timeline approach</li>
                                                    <li>Focus on Tesla's advantages vs Waymo's constraints (geo-fencing, L4 redundancies)</li>
                                                    <li>Create executive summary for Mobility Ops team</li>
                                                    <li>Get Sarah Chen's input on GTM levers that resonate</li>
                                                </ul>
                                                
                                                <div className="tesla-notion-callout">
                                                    üéØ <strong>Primary Actions:</strong> Update slide 88 with competitive strategic positioning, reach out to Sarah Chen, create exec summary for Mobility Ops
                                                </div>
                                            </div>
                                        </div>

                                        {/* Presentation Section */}
                                        <div className="tesla-notion-section">
                                            <h2 className="tesla-notion-heading">üìä Presentation</h2>
                                            <div className="tesla-notion-file-link" onClick={() => window.open('#', '_blank')}>
                                                <div className="tesla-notion-file-icon powerpoint">üìä</div>
                                                <div className="tesla-notion-file-info">
                                                    <div className="tesla-notion-file-name">Tesla_GTM_Austin_Strategy.pptx</div>
                                                    <div className="tesla-notion-file-meta">Updated 2 minutes ago ‚Ä¢ 4.1 MB</div>
                                                </div>
                                                <div className="tesla-notion-file-action">Open ‚Üí</div>
                                            </div>
                                        </div>

                                        {/* Documents Section */}
                                        <div className="tesla-notion-section">
                                            <h2 className="tesla-notion-heading">üìÑ Strategic Input</h2>
                                            <div className="tesla-notion-text">
                                                <p><strong>Strategic Recommendations from Sarah Chen</strong></p>
                                                <div className="tesla-notion-callout" style={{background: '#f0f9ff', border: '1px solid #0ea5e9', borderRadius: '8px', padding: '12px', margin: '12px 0'}}>
                                                    ‚úÖ <strong>Suggestions on which strategies to include added to context</strong><br/>
                                                    <em>Focus areas: Tesla's superior AI integration, cost advantages, and existing Austin infrastructure partnerships</em>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Timeline Section */}
                                        <div className="tesla-notion-section">
                                            <h2 className="tesla-notion-heading">‚è∞ Timeline & Deadlines</h2>
                                            <div className="tesla-notion-table">
                                                <div className="tesla-notion-table-header">
                                                    <div className="tesla-notion-table-cell">Task</div>
                                                    <div className="tesla-notion-table-cell">Status</div>
                                                    <div className="tesla-notion-table-cell">Deadline</div>
                                                </div>
                                                <div className="tesla-notion-table-row">
                                                    <div className="tesla-notion-table-cell">Request GTM Strategy Insights</div>
                                                    <div className="tesla-notion-table-cell">
                                                        <span className="tesla-notion-status done">‚úÖ Complete</span>
                                                    </div>
                                                    <div className="tesla-notion-table-cell">Today</div>
                                                </div>
                                                <div className="tesla-notion-table-row">
                                                    <div className="tesla-notion-table-cell">Update Competitive Analysis</div>
                                                    <div className="tesla-notion-table-cell">
                                                        <span className="tesla-notion-status done">‚úÖ Complete</span>
                                                    </div>
                                                    <div className="tesla-notion-table-cell">Today</div>
                                                </div>
                                                <div className="tesla-notion-table-row">
                                                    <div className="tesla-notion-table-cell">Develop Market Penetration Strategy</div>
                                                    <div className="tesla-notion-table-cell">
                                                        <span className="tesla-notion-status pending">‚è≥ In Progress</span>
                                                    </div>
                                                    <div className="tesla-notion-table-cell">Tomorrow</div>
                                                </div>
                                                <div className="tesla-notion-table-row">
                                                    <div className="tesla-notion-table-cell">Prepare Executive Summary</div>
                                                    <div className="tesla-notion-table-cell">
                                                        <span className="tesla-notion-status pending">üìù To Do</span>
                                                    </div>
                                                    <div className="tesla-notion-table-cell">Wed</div>
                                                </div>
                                                <div className="tesla-notion-table-row">
                                                    <div className="tesla-notion-table-cell">Final Review with Manager</div>
                                                    <div className="tesla-notion-table-cell">
                                                        <span className="tesla-notion-status scheduled">üìÖ Scheduled</span>
                                                    </div>
                                                    <div className="tesla-notion-table-cell">End of Week</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className={`tesla-task-panel ${showTasks ? 'open' : ''}`}>
                            <div className="tesla-task-header">
                                <div className="tesla-task-title">Project Tasks</div>
                                <div className="tesla-task-subtitle">Tesla GTM Strategy - Austin vs Waymo</div>
                            </div>
                            <div className="tesla-task-list">
                                {tasks.map((task) => (
                                    <div key={task.id} className={`tesla-task-item ${completedTasks.has(task.id) ? 'completed' : ''}`}>
                                        <div className="tesla-task-checkbox">
                                            {completedTasks.has(task.id) ? '‚úì' : '‚óã'}
                                        </div>
                                        <div className="tesla-task-content">
                                            <div className="tesla-task-item-title">{task.title}</div>
                                            <div className="tesla-task-item-desc">{task.description}</div>
                                            <div className={`tesla-task-item-priority ${task.priority}`}>
                                                {task.priority.toUpperCase()} PRIORITY
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Global variable to track if React component is mounted
        let teslaReactMounted = false;

        // Function to mount React component
        function mountTeslaChat() {
            if (!teslaReactMounted) {
                const container = document.getElementById('tesla-react-container');
                if (container) {
                    ReactDOM.render(<TeslaChat />, container);
                    teslaReactMounted = true;
                }
            }
        }

        // Function to unmount React component
        function unmountTeslaChat() {
            if (teslaReactMounted) {
                const container = document.getElementById('tesla-react-container');
                if (container) {
                    ReactDOM.unmountComponentAtNode(container);
                    teslaReactMounted = false;
                }
            }
        }
    </script>

    <!-- Existing JavaScript (keep all existing functionality) -->
    <script>
        // Home tab click
        document.getElementById('home-tab').addEventListener('click', function() {
            document.querySelectorAll('.nav-item, .project-item').forEach(i => i.classList.remove('active'));
            this.classList.add('active');
            document.getElementById('main-content-home').style.display = '';
            document.getElementById('main-content-tools').style.display = 'none';
            document.getElementById('main-content-tesla').style.display = 'none';
            unmountTeslaChat();
        });

        // Tools tab click
        document.getElementById('tools-tab').addEventListener('click', function() {
            document.querySelectorAll('.nav-item, .project-item').forEach(i => i.classList.remove('active'));
            this.classList.add('active');
            document.getElementById('main-content-home').style.display = 'none';
            document.getElementById('main-content-tools').style.display = '';
            document.getElementById('main-content-tesla').style.display = 'none';
            unmountTeslaChat();
        });

        // Project click - Updated to use React
        document.querySelectorAll('.project-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.nav-item, .project-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                document.getElementById('main-content-home').style.display = 'none';
                document.getElementById('main-content-tools').style.display = 'none';
                document.getElementById('main-content-tesla').style.display = '';
                
                // Mount React component with a small delay
                setTimeout(() => {
                    mountTeslaChat();
                }, 100);
            });
        });

        // Keep all existing functionality for other parts
        document.querySelectorAll('.connect-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                if (!btn.classList.contains('connected')) {
                    btn.classList.add('connected');
                    btn.textContent = 'Connected';
                } else {
                    btn.classList.remove('connected');
                    btn.textContent = 'Connect';
                }
            });
        });
    </script>
</body>
</html> 